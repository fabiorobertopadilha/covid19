---
header-includes:
  - \usepackage[brazil]{babel}
  - \usepackage{graphicx}
  - \usepackage[utf8]{inputenc}
  - \usepackage{color}
  - \usepackage{pdfpages} 
  - \usepackage[titletoc,toc,page]{appendix}
output: pdf_document
fontsize: 12pt
latex_engine: latex2
--- 

\begin{titlepage}
\vfill
\begin{center}
{\normalsize \textbf{PONTIFÍCIA UNIVERSIDADE CATÓLICA DE MINAS GERAIS \\ NÚCLEO DE EDUCAÇÃO À DISTÂNCIA \\ Pós-graduação Lato Sensu em Ciência de Dados e Big Data}} \\[4cm]
{\large \textbf{Fábio Roberto Barros Padilha}}\\[4cm]
{\normalsize ANÁLISE DE DADOS NACIONAIS SOBRE A EVOLUÇÃO \\ DAS SÍNDROMES RESPIRATÓRIAS AGUDAS GRAVES, \\ PROVENIENTES DO SARS-CoV-2, NO ANO DE 2020}\\[5.5cm]
\large \textbf{Belo Horizonte}\\
\large \textbf{Fevereiro de 2021}
\end{center}
\end{titlepage}


\newpage

\begin{titlepage}
\vfill
\begin{center}
{\large \textbf{Fábio Roberto Barros Padilha}}\\[8cm]
{\normalsize ANÁLISE DE DADOS NACIONAIS SOBRE A EVOLUÇÃO \\ DAS SÍNDROMES RESPIRATÓRIAS AGUDAS GRAVES, \\ PROVENIENTES DO SARS-CoV-2, NO ANO DE 2020}\\[3.5cm]
\hspace{.45\textwidth} %posiciona a minipage
\begin{minipage}{.5\textwidth}
\large Trabalho de Conclusão de Curso apresentado ao Curso de Especialização em Ciência de Dados e Big Data como requisito parcial à obtenção do título de especialista. \\[1cm]
\end{minipage}
\vfill
\vspace{3cm}
\large \textbf{Belo Horizonte}\\
\large \textbf{Fevereiro de 2021}
\end{center}
\end{titlepage}

\newpage

\let\oldShaded\Shaded
\let\endoldShaded\endShaded
\renewenvironment{Shaded}{\footnotesize\oldShaded}{\endoldShaded}

\let\oldverbatim\verbatim
\let\endoldverbatim\endverbatim
\renewenvironment{verbatim}{\scriptsize\oldverbatim}{\endoldverbatim}

\newpage

\tableofcontents


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\newpage

\section{1. Introdução}

\

\qquad Nos últimos anos, o aumento de dados disponíveis digitalmente e o aparecimento de novas tecnologias têm favorecido a produção de conhecimento útil para sociedade.

\qquad De acordo com Gilson Medeiros de Oliveira Junior (2010):

\
\begin{flushright}
\begin{minipage}{0.7\linewidth}
\begin{footnotesize} 
O uso de técnicas de inteligência artificial, mais especificamente algoritmos de aprendizagem para classificação de padrões, tem crescido bastante nos últimos anos pelo fato de auxiliarem na resolução de problemas complexos do mundo real que podem envolver um elevado número de variáveis [...]. (JUNIOR, 2010, p.1)\cite{JUNIOR:2010}
\end{footnotesize}
\end{minipage}
\end{flushright}
\

\qquad Esses algoritmos de aprendizagem estão relacionados ao aprendizado de máquina (machine learning), que é uma parte de Inteligência Artificial (IA) onde um algoritmo computacional cria, a partir dos dados disponíveis, modelos de aprendizado para a resolução de problemas (MEHTA, 2017).\cite{MEHTA:2017}

\qquad Dentre as técnicas de aprendizagem de máquina, pode-se citar o algoritmo de Naive Bayes, importante classificador probabilístico, que é, frequentemente, utilizado em processamento de diagnósticos médicos (cálculo de probabilidades em cima de diagnóstico de doenças), segundo Pedro César Tebaldi Gomes (2019) \cite{GOMES:2019}.

\qquad Outros importantes algoritmos de aprendizagem são as máquinas de vetores suporte - SVMs (Support Vector Machines), que “[...] têm a capacidade de resolver problemas de classificação e regressão, adquirindo com o aprendizado na etapa de treinamento a capacidade de generalização” (JUNIOR, 2010, p.5). \cite{JUNIOR:2010}

\qquad Por fim, pode-se destacar a técnica de mineração de dados de árvore de decisão na aprendizagem de máquina. De acordo com Hosokawa (2011) \cite{Hosokawa:2011}, a árvore de decisão é um modelo preditivo, representado por um gráfico em forma de árvore, contendo as decisões a serem tomadas e seus possíveis riscos, custo e prejuízos. 

\qquad Neste sentido, este trabalho utilizou as técnicas citadas acima, dentre outras, para análise de dados do Sistema Único de Saúde (SUS) relacionados às Síndromes Respiratórias Agudas Graves (SARS) relacionadas à convid-19, em 2020. De forma a identificar as regiões do Brasil mais impactadas pela covid-19, bem como os perfis com mair risco de morte, contribuindo com informações importantes para implementação de políticas de saúde pública, a exemplo da elaboração de um plano nacional de vacinação.

\newpage

\subsection{1.1 Contextualização}

\

\qquad O ano de 2020 foi marcado por isolamento, medo e insegurança, causados pela pandemia do novo coronavírus SARS-CoV-2 e, com ela, pelo aumento considerável dos casos de óbitos por covid-19.

\qquad Durante todo o curso da pandemia, um dos principais problemas que as autoridades e os profissionais de saúde enfrentaram foi a falta de informação: de recursos médicos, como respiradores, e de um plano adequado para sua distribuição. 

\qquad Como o novo coronavírus é a principal causa para o aumento dos casos de mortes de Síndrome Respiratória Aguda Grave (SARS), identificar as regiões do Brasil mais afetas, bem como ser capaz de prever os perfis com maior risco de morte, será de grande ajuda para as autoridades na elaboração de políticas públicas na área da saúde.

\qquad Dado o atual volume de informações relacionados ao SARS-CoV-2 (Covid-19) e às Síndromes Respiratórias Agudas Graves disponíveis, é possível se utilizar da tecnologia, como a inteligência artificial, para realizar predições que auxiliem as autoridades da área de saúde e os médicos na elaboração de planos no combate ao novo coronavírus.

\qquad Sobre o uso das informações geradas com base nestas análises preditivas, Roberto Moreira Santos (2017) afirma que:

\
\begin{flushright}
\begin{minipage}{0.7\linewidth}
\begin{footnotesize} 
A aplicação desses resultados provenientes das análises é de suma importância para vários setores: como o setor da saúde, que consegue mapear os riscos de certas doenças que ocorrem em determinados grupos de pacientes, ou a resposta aos melhores medicamentos [...] (SANTOS, 2017, p.10)\cite{SANTOS:2017}
\end{footnotesize}
\end{minipage}
\end{flushright}
\

\qquad Neste contexto, “A analítica preditiva pode ser apoiada por técnicas da computação como aprendizagem de máquina (machine learning) e a mineração de dados para aumentar seu potencial de precisão” (WAYNE, 2007 apud SANTOS, 2017, p.11).

\qquad Dada a situação de calamidade pública provocada pelo novo Coronavírus SARS-CoV-2, que levou o Brasil a ultrapassar a marca de 180 mil mortes por covid-19, em 2020, e a chegada da vacina, buscou-se utilizar, neste trabalho, técnicas de mineração de dados e machine learning, com apoio do RStudio para o desenvolvimento de um projeto de ciência de dados com proposito de contribuir com a contenção da doença no Brasil. As bibliotecas utilizadas na elaboração do projeto estão descritas na tabela \ref{tab:pacotesR} apresentada abaixo:

\begin{table}[htp!]
\center
\begin{tabular}{|c|c|c|c|c|c|} \hline
ggplot2 & gridExtra & geobr & geobr & dplyr & latexpdf \\ \hline
stringr & openxlsx & rpart & e1071 & randomForest & scales  \\ \hline
\end{tabular}
\caption{Pacotes R}
\label{tab:pacotesR}
\end{table}

\qquad Assim, espera-se que as predições apresentadas com base no uso dessas tecnologias gerem conhecimentos úteis que auxiliem as autoridades públicas na implementação de políticas públicas na área da saúde e capacitem melhor o país na contenção da doença. 

\newpage

```{r pacotes, include=FALSE}
#Instalar 
#install.packages("ggplot2")
#install.packages("rpart")
#install.packages("randomForest")
#install.packages("e1071")

#Carregar
library(ggplot2)
library(gridExtra)
library(geobr)
library(sf)
library(scales)
library(dplyr)
library(openxlsx)
library(latexpdf)
library(stringr)
library(zoo)
library(rpart)
library(e1071)
library(randomForest)
library(xtable)

#Configuração dos gráficos
options(scipen = 999)
cores = c("#eabeac", "#b6dfe0", "#e2cfb4", "#d7d9bd", "#d6b9dd", "#b3b4e3", "#abcaeb", "#ebabab", "#e6b0c7", "#eabeac", "#c1d8be", "#d7d9bd", "#d6b9dd", "#eabeac")
coresIntensas = c("black", "#ff4b03", "#2ae4e8", "#baa07b", "green", "#bf36e0")
#coresSudeste = c("#d7d9bd", "#d3d6a3", "#cacf7e", "#c6cf42")
coresSudeste = c("#d7d9bd", "#d7d9bd", "#d7d9bd", "#d7d9bd")
#coresNordeste = c("#b6dfe0", "#abddde", "#9eddde", "#94dfe0", "#84dadb", "#7ddadb", "#6bdadb", "#5edfe0", "#4ddadb", "#3fd8d9", "#2fd5d6", "#1cd3d4")
coresNordeste =  c("#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0", "#b6dfe0")
coresEvolucao = c("#80baa6", "#e08565", "#f5a98e")
coresFRisco = c("#1FDA9A", "#F38630")
ptBr <- list(
  ª = "."
)

```

\subsection{1.2 Objetivos}

\

\qquad A pandemia do SARS-CoV-2 está impondo ao Brasil e ao mundo o maior desafio sanitário dos últimos 100 anos, tendo sido a Gripe Espanhola, ocorrida no ano de 1918, a última pandemia registrada de grande impacto mundial. Neste contexto, há uma atuação ativa por parte das autoridades de saúde na implementação de políticas públicas para conter o avanço da doença e o crescente número de óbitos. 

\qquad Embora o Brasil, tenha um dos melhores sistemas de saúde da América Latina, a capacidade de atendimento em todo país é bastante desigual. Nas regiões mais pobres, onde a capacidade de atendimento de saúde é menor, têm-se observado a existência de situações críticas, como a falta de médicos, de recursos e de leitos hospitalares.

\qquad Neste contexto, este trabalho tem como objetivo geral entender, de forma regionalizada, a evolução dos casos graves da doença, a fim de contribuir com as autoridades da área de saúde na construção de políticas públicas voltadas para redução do número de óbitos e para contenção do novo coronavírus.

\qquad É importante destacar que, para este trabalho, são considerados casos graves de covid-19 aqueles existentes no arquivo CSV do OpenDataSUS. 

\qquad Por fim, têm-se os seguintes objetivos específicos que irão ajudar na consecução do objetivo geral deste trabalho de conclusão de curso:

\begin{itemize}
\item identificar as regiões brasileiras com maior número de óbitos por covid-19;
\item identificar a taxa de mortalidade por covid-19 dos estados e capitais;
\item apresentar a evolução da taxa de letalidade da doença, ao logo do ano de 2020, por regiões;
\item encontrar os perfis dos pacientes com maiores e menores riscos de morte por covid-19. 
\item utilizar técnicas de machine lerarnig para identificar o percentual de acerto do risco morte por covid-19 a partir dos atributos selecionados na pesquisa.
\end{itemize}

\newpage

\section{2. Coleta dos dados}

\

\qquad Nesse trabalho foram utilizada 2 (duas) fontes de dados, uma disponibilizada pela Secretaria de Vigilância em Saúde no portal OpenDataSUS e a outra disponibilizada no portal do Instituto Brasileiro de Geografia e Estatística (IBGE), cujo detalhamento será apresentado nas seções seguintes.

\

\subsection{2.1 Dados OpenDataSUS}

\

\qquad Dentre os dados utilizados neste trabalho, destacam-se os dados fornecidos pela Secretaria de Vigilância em Saúde, que está vinculada ao Ministério da Saúde, no portal OpenDataSUS. Sobre os dados coletados, o portal OpenDataSUS informa que:\cite{OPENDATASUS:2021}

\
\begin{flushright}
\begin{minipage}{0.7\linewidth}
\begin{footnotesize} 
Esta página tem como finalidade disponibilizar o legado dos bancos de dados (BD) epidemiológicos de SRAG, da rede de vigilância da Influenza e outros vírus respiratórios, desde o início da sua implantação (2009) até os dias atuais (2021), com a incorporação da vigilância da COVID-19. Atualmente, o sistema oficial para o registro dos casos e óbitos de SRAG é o Sistema de Informação da Vigilância Epidemiológica da Gripe (SIVEP-Gripe).
\end{footnotesize}
\end{minipage}
\end{flushright}
\

\qquad O arquivo utilizado neste trabalho foi disponbilizado para \href{https://opendatasus.saude.gov.br/dataset/bd-srag-2021/resource/42bd5e0e-d61a-4359-942e-ebc83391a137}{\underline{\color{blue} download em formato CSV}}. É importante observar que este arquivo é atualizado semanalmente e que, no momento do download, continha dados até 04/01/2021.

\qquad Como a Secretaria de Vigilância em Saúde atualiza os dados semanalmente, para garantir o acesso ao arquivo analisado neste trabalho, fez-se necessário manter uma cópia no Google drive, que pode ser acessada no link: {\underline{\color{blue} \url{https://drive.google.com/drive/folders/1l52SO-RMHYfs2ci_2pBAZJNw2hA5i2me?usp=sharing}}

\qquad O arquivo contém 1.103.183 (um milhão cento e três mil e cento e oitenta e três) linhas e 154 colunas. Cada linha do arquivo corresponde ao registro de um paciente com a síndrome respiratória aguda grave. As 154 colunas são campos coletados a partir da  \href{https://opendatasus.saude.gov.br/dataset/bd-srag-2021/resource/bd725e4c-c869-400f-a479-9b544c2812b4}{\underline{\color{blue} ficha de notificação do paciente}}, além de informações geradas pelo sistema. A ficha de notificação e o dicionário de dados estão disponíveis, respectivamente, nos anexos A e B. O trecho de código para importação do arquivo segue descrito abaixo:
\

```{r importarArquivoSuS}
arquivo = read.csv("dados/INFLUD-04-01-2021.csv", header = T, sep = ";",
na.strings = "",stringsAsFactors = T)
```

\qquad Após a importação dos dados, as colunas objeto da análise foram selecionadas e renomeadas, a fim de facilitar a identificação nas seções seguintes. Os trechos de código, para selecionar e renomear as colunas seguem descritos abaixo:

\
A) Selecionar:

```{r selectColunasSUS, results='hide'}
pacientes = arquivo[ , c("DT_NOTIFIC", "SEM_NOT", "DT_SIN_PRI", "SEM_PRI", "SG_UF_NOT",
"ID_MUNICIP", "CO_MUN_NOT", "ID_UNIDADE", "CO_UNI_NOT",
"CS_SEXO", "NU_IDADE_N", "CS_GESTANT", "CS_RACA", "SURTO_SG", "NOSOCOMIAL", "FEBRE",
"TOSSE", "GARGANTA", "DISPNEIA", "DESC_RESP", "SATURACAO", "DIARREIA", "VOMITO", 
"DOR_ABD","FADIGA",  "PERD_OLFT", "PERD_PALA", "FATOR_RISC", "PUERPERA", 
"CARDIOPATI", "HEMATOLOGI", "SIND_DOWN", "HEPATICA", "ASMA", "DIABETES", 
"NEUROLOGIC", "PNEUMOPATI", "IMUNODEPRE","RENAL", "OBESIDADE", "OBES_IMC", "VACINA",
"ANTIVIRAL", "HOSPITAL", "DT_INTERNA", "UTI","DT_ENTUTI", "DT_SAIDUTI",
"SUPORT_VEN", "RAIOX_RES", "TOMO_RES", "AMOSTRA", "TP_TES_AN","RES_AN",
"POS_AN_FLU", "TP_FLU_AN", "POS_AN_OUT", "AN_SARS2", "AN_VSR",
"AN_PARA1", "AN_PARA2", "AN_PARA3", "AN_ADENO", "PCR_RESUL", "POS_PCRFLU",
"TP_FLU_PCR", "PCR_FLUASU","PCR_FLUBLI", "POS_PCROUT", "PCR_SARS2", "PCR_VSR",
"PCR_PARA1", "PCR_PARA2", "PCR_PARA3","PCR_PARA4", "PCR_ADENO", "PCR_METAP",
"PCR_BOCA", "PCR_RINO", "TP_AM_SOR", "TP_SOR","RES_IGG", "RES_IGM", "RES_IGA",
"CLASSI_FIN", "CRITERIO", "EVOLUCAO", "DT_EVOLUCA")]
```

\
B) Renomear:

```{r renomearColuna, results='hide'}
colnames(pacientes) =  c("DT_NOTIFICACAO", "SEMANA_NOTIFICACAO", "DT_PRIMEIROS_SINTOMAS",
"SEMANA_PRIMEIROS_SINTOMAS", "SG_UF", "MUNICIPIO",
"COD_MUNICIPIO", "HOSPITAL", "COD_HOSPITAL","CS_SEXO", "NU_IDADE", "CS_GESTANTE",
"CS_RACA", "IN_SURTO_SINDROME_GRIPAL", "IN_NOSOCOMIAL", "IN_FEBRE", "IN_TOSSE",
"IN_GARGANTA", "IN_DISPNEIA", "IN_DESCONFORTO_RESP", "IN_SATURACAO", "IN_DIARREIA",
"IN_VOMITO", "IN_DOR_ABDOMINAL", "IN_FADIGA", "IN_PERDA_OLFTATO",  "IN_PERDA_PALADAR",
"IN_FATOR_RISC", "IN_PUERPERA", "IN_CARDIOPATI", "IN_HEMATOLOGI", "IN_SINDROME_DOWN",
"IN_DOENCA_HEPATICA", "IN_ASMA", "IN_DIABETES", "IN_DOENCA_NEUROLOGICA",
"IN_PNEUMOPATIA_CRONICA", "IN_IMUNODEPRESSAO", "IN_DOENCA_RENAL", "IN_OBESIDADE",
"NU_OBESIDADE_IMC", "IN_RECEBEU_VACINA_GRIPE", "IN_USOU_ANTIVIRAL", "IN_HOSPITALIZADO",
"DT_INTERNACAO", "IN_UTI", "DT_ENTRADA_UTI", "DT_SAIDA_UTI", "CS_SUPORTE_VENTILATORIO",
"CS_RAIOX_RESULTADO", "CS_TOMOGRAFIA_RESULTADO", "IN_COLETOU_AMOSTRA",
"CS_TESTE_ANTIGENO","CS_RESULTADO_ANTIGENO", "IN_POSITIVO_INFLUENZA",
"CS_TIPO_INFLUENZA","IN_POSITIVO_OUT_VIRUS", "IN_POSITIVO_SARS2",
"IN_POSITIVO_VSR","IN_POSITIVO_PARAINFLUENZA1", "IN_POSITIVO_PARAINFLUENZA2",
"IN_POSITIVO_PARAINFLUENA3","IN_POSITIVO_ADENOVIRUS", "CS_PCR_RESULTADO",
"IN_POSITIVO_PCR_INFLUENZA","CS_TIPO_INFLUENZA_PCR", "CS_PCR_INFLUENZA_A_SUBTIPO",
"CS_PCR_FLU_B_LINHAGEM","IN_PCR_POSITIVO_OUT_VIRUS", "IN_PCR_POSITIVO_SARS2",
"IN_PCR_POSITIVO_VSR","IN_PCR_POSITIVO_PARAINFLUENZA1",
"IN_PCR_POSITIVO_PARAINFLUENZA2","IN_PCR_POSITIVO_PARAINFLUENZA3",
"IN_PCR_POSITIVO_PARAINFLUENZA4","IN_PCR_POSITIVO_ADENOVIRUS",
"IN_PCR_POSITIVO_METAPNEUMOVIRUS","IN_PCR_POSITIVO_BOCAVIRUS",
"IN_PCR_POSITIVO_RINOVIRUS", "CS_TIPO_AMOSTRA_SOROLOGICA_SARS_COV2",
"CS_TESTE_SOROLOGICO","IN_SOROLOGICO_POSITIVO_IGG", "IN_SOROLOGICO_POSITIVO_IGM",
"IN_RESULTADO_POSITIVO_IGA","CS_CLASSICACAO_FINAL", "CS_CRITERIO_CONFIRMACAO",
"CS_EVOLUCAO", "DT_EVOLUCAO")
```

\

\subsection{2.2 Dados do Instituto Brasileiro de Geografia e Estatística}

\qquad Fez-se necessário enriquecer este trabalho com dados do Instituto Brasileiro de Geografia e Estatística - IBGE, tanto para o cálculo das taxas de mortalidades, bem como para elaboração dos mapas.

\qquad O IBGE disponibiliza o arquivo no link: {\underline{\color{blue} \url{https://www.ibge.gov.br/estatisticas/downloads-estatisticas.html}}}, no diretório: Estimativa_de_Populacao/Estimativas_2020, em formato xls, conforme figura \ref{fig:downloadIbge} abaixo:

\
\begin{figure}[htp!]
\center
\includegraphics[width=0.5\linewidth]{anexos/download-ibge.png}
\caption{Arquivo IBGE}
\label{fig:downloadIbge}
\end{figure}
\

\qquad Após o download, o arquivo foi convertido para o formato xlsx, no LibreOffice, para facilitar a importação para RStudio. O arquivo contém duas abas, uma com a estimativa populacional por unidade federativa e outra aba com a estimativa populacional por municípios.

\qquad Para este trabalho, importamos apenas os dados da aba municípios, uma vez que a população por estado ou por região pode ser facilmente obtida a partir do somatório populacional dos municípios.

\qquad A importação dos dados foi iniciada a partir da terceira linha do arquivo, a fim de desconsiderar as linhas referentes ao cabeçalho, conforme trecho de código a seguir:

\

```{r importarDadosIBGE, results='hide'}
arquivoIBGE=read.xlsx("dados/POP2020_20201030.xlsx", sheet = "Municípios",
startRow = 3, colNames =FALSE, rowNames = FALSE)
```

```{r importarDadosIBGE2, include=FALSE}
#Download de conjuntos de dados espaciais oficiais do Brasil.
municipios <- read_municipality(year=2019)
estados <- read_state(year=2019)
regioes <- read_region(year=2019)
```


\newpage

\section{3. Processamento}

\

\qquad Este capítulo contempla as transformações realizadas nos data frames resultantes das importações dos arquivos CSV (disponibilizado no portal OpenDataSUS) e XLS (disponibilizado no portal do IBGE). Estes campos tratados são os principais atributos utilizados nos algoritmos e gráficos constantes nos capítulos seguintes.

\subsection{3.1 Dados do Instituto Brasileiro de Geografia e Estatística}

\

\qquad Os dados populacionais do IBGE, necessários para realização deste trabalho, estão presentes da linha 3 até a linha 5572, de acordo com as figuras \underline{\color{blue}\ref{fig:arquivoIbge}} e \underline{\color{blue}\ref{fig:rodapeIbge}}:

\

\begin{figure}[htp]
\center
\includegraphics[width=0.5\linewidth]{anexos/cabecalho-IBGE.png}
\caption{Arquivo IBGE}
\label{fig:arquivoIbge}
\end{figure}

\begin{figure}[htp]
\center
\includegraphics[width=0.5\linewidth]{anexos/rodape-IBGE.png}
\caption{Rodapé arquivo IBGE}
\label{fig:rodapeIbge}
\end{figure}


\qquad A importação dos dados foi iniciada a partir da linha três do arquivo, descartando o cabeçalho. Para descartar o rodapé do data frame resultante da importação, foi selecionado somente até a linha 5.570 (cinco mil quinhentos e setenta). Por fim, foi criando um campo extra no data frame para armazenar o código do município sem o último dígito.

\qquad A necessidade de criar uma coluna extra para o município sem o dígito verificador, ocorreu devido a ausência do dígito verificar no arquivo CSV disponibilizado no portal OpenDataSUS. O campo criado com o código do município sem o dígito verificador, foi utilizado em JOINs nas seções seguintes, onde serão criados gráficos pelas diversas localidades do país.

```{r transfIBGE, include=FALSE}
#Seleção dos dados e criação do campo sem dígito validador
municipiosIBGE = arquivoIBGE[1:5570,]
colnames(municipiosIBGE) = c("SG_UF", "COD_UF", "COD_MUNICIPIO", "MUNICIPIO", "NU_POPULACAO")

municipiosIBGE["COD_MUNICIPIO"]=paste(municipiosIBGE$COD_UF, municipiosIBGE$COD_MUNICIPIO, sep = "")
municipiosIBGE["COD_MUNICIPIO"]=as.integer(municipiosIBGE$COD_MUNICIPIO)

municipiosIBGE["COD_MUNICIPIO6"]=as.integer(municipiosIBGE$COD_MUNICIPIO/10)
municipiosIBGE$COD_MUNICIPIO6=as(municipiosIBGE$COD_MUNICIPIO6, "integer")
#Removendo a coluna de ID da UF
municipiosIBGE = municipiosIBGE[, c("SG_UF", "COD_MUNICIPIO6", "COD_MUNICIPIO", "MUNICIPIO", "NU_POPULACAO")] 
#Removendo marcadores de citação
municipiosIBGE$NU_POPULACAO = str_replace_all(municipiosIBGE$NU_POPULACAO, c("\\(.+\\)"), "")
##Convertendo população para integer
municipiosIBGE$NU_POPULACAO = as(municipiosIBGE$NU_POPULACAO, "integer")
```

\qquad É importante destar que a informação das regiões do país (norte, nordeste, centro-oeste, sudeste e sul) não estavam presentes nos arquivos apresentados. Tornando-se necessária a criação de uma matriz com os estados e suas respectivas regiões. Essa matriz permitiu o enriquecimento dos dados e a produção dos gráficos sumarizados, conforme trecho de código abaixo:

\

```{r matrizRegiao}
regiao = matrix(data = NA, nrow = 27, ncol = 2, byrow = TRUE)
regiao[1,] = c("AC", "Norte")
regiao[2,] = c("AP", "Norte")
regiao[3,] = c("AM", "Norte")
regiao[4,] = c("PA", "Norte")
regiao[5,] = c("RO", "Norte")
regiao[6,] = c("RR", "Norte")
regiao[7,] = c("TO", "Norte")
regiao[8,] = c("AL", "Nordeste")
regiao[9,] = c("BA", "Nordeste")
#Continua para todos os 27 estados...
```

```{r  matrizRegiao2, include=FALSE}
regiao[10,] = c("CE", "Nordeste")
regiao[11,] = c("MA", "Nordeste")
regiao[12,] = c("PB", "Nordeste")
regiao[13,] = c("PE", "Nordeste")
regiao[14,] = c("PI", "Nordeste")
regiao[15,] = c("RN", "Nordeste")
regiao[16,] = c("SE", "Nordeste")
regiao[17,] = c("ES", "Sudeste")
regiao[18,] = c("MG", "Sudeste")
regiao[19,] = c("RJ", "Sudeste")
regiao[20,] = c("SP", "Sudeste")
regiao[21,] = c("PR", "Sul")
regiao[22,] = c("RS", "Sul")
regiao[23,] = c("SC", "Sul")
regiao[24,] = c("DF", "Centro-Oeste")
regiao[25,] = c("GO", "Centro-Oeste")
regiao[26,] = c("MT", "Centro-Oeste")
regiao[27,] = c("MS", "Centro-Oeste")
regiao=data.frame(regiao)
colnames(regiao)=c("SG_UF", "REGIAO")
```

```{r enriquecendoDfPaciente}
pacientes = pacientes %>% left_join(regiao, c("SG_UF" = "SG_UF"))
```

```{r tratamentoIBGE2, include=FALSE}
estadoIBGE=municipiosIBGE %>% 
  group_by(SG_UF) %>%
  summarise(.groups = "drop_last",
    QTD_MUNICIPIO=n(),
    NU_POPULACAO=sum(NU_POPULACAO)
  ) %>%
arrange(desc(QTD_MUNICIPIO))
estadoIBGE = estadoIBGE %>% inner_join(regiao, c("SG_UF" = "SG_UF"))
regiaoIBGE=estadoIBGE %>% 
  group_by(REGIAO) %>%
  summarise(.groups = "drop_last",
    QTD_ESTADO=n(),
    NU_POPULACAO=sum(NU_POPULACAO)
  ) %>%
arrange(desc(QTD_ESTADO))
```

\subsection{3.2 OpenDataSUS}

\qquad A transformação dos dados do SUS, disponibilizados no portal OpenDataSUS, foi realizada em duas etapas. Na primeira etapa, o processamento teve como finalidade favorecer a elaboração de gráficos no ggplot2 a fim de apresentar a distribuição dos dados. Já na segunda etapa, outras transformações aconteceram com o propósito de ajustar os dados para as execuções dos algorítimos de machine learning.

\qquad Nas subseções abaixo, será realizado o detalhamento das principais colunas do arquivo CSV disponibilizado no portal OpenDataSUS. Ressalta-se que não foi necessário detalhar a transformação do arquivo disponibilizado pelo IBGE, uma vez que o mesmo não precisou de transformações significativas, além das já mencionadas no item 3.1.  

\qquad É importante enfatizar, ainda, que foi necessário elaborar gráficos preliminares nessas subseções, a fim de validar o processamento. No entanto, os gráficos mais elaborados e que trazem informações mais importantes para este trabalho estão dispostos no capítulo 4.

```{r percentualValoresOmissos, include=FALSE}
#Percentuais de Valores Omissos nas colunas selecionadas
NAS <- round(colSums(is.na(pacientes))*100/nrow(pacientes),2) 
NAS
```

\subsection{3.3 Transformação}

\qquad A partir dessa seção será feita a limpeza e transformação dos dados, de maneira mais significativa. Nas seções anteriores, o processamento dos dados se restringiu a importar os arquivos objeto da análise e enriquecer um dos data frame resultante da importação com as regiões do país. Para melhor visualizar o que já foi realizado até o momento, segue figura com fluxo do pré-processado dos dados: \underline{\color{blue}\ref{fig:preProcDados}}

\begin{figure}[htp]
\center
\includegraphics[width=0.8\linewidth]{anexos/fluxocoleta.png}
\caption{Pré-processamento dos dados}
\label{fig:preProcDados}
\end{figure}

\qquad Nas subseções abaixo, será realizado o detalhamento das principais colunas do arquivo CSV disponibilizado no portal OpenDataSUS, uma vez que o arquivo disponibilizado pelo IBGE não precisou de transformações significativas além das já mencionadas no item 3.1. Assim como foi Bem como a elaboração de gráficos preliminares com intuito de validar o processamento.

\subsubsection{3.3.1 Notificações}

\qquad O campo DT_NOTIFICACAO, que contém a data do preenchimento da ficha de notificação, foi ajustado para o formato dd/mm/aaaa. Após a conversão do campo, foi necessária a realização de algumas limpezas nos dados, como a remoção dos registros com data de notificação superior a 31/12/2020 do data frame, visto que o escopo desse trabalho é o ano de 2020, bem como a retirada das notificações que não foram classificadas como casos de covid-19. 

\

```{r dtNotificacao}
#Redefinir tipo de dados da coluna 
pacientes$DT_NOTIFICACAO = as.Date(pacientes$DT_NOTIFICACAO, format="%d/%m/%Y")
pacientes["MES_NOTIFICACAO"]=format(pacientes$DT_NOTIFICACAO, "%Y/%m");
#Removendo ocorrencia com datas de notificação superior a 31/12/2020 
pacientes=pacientes[pacientes$DT_NOTIFICACAO<as.Date("01/01/2021", format="%d/%m/%Y"),]
```

\

\qquad É importante destacar que não existem valores omissos na coluna DT_NOTIFICACAO.

```{r dtNotificacaoOmisso, include=FALSE}
#Percentual valores omissos
as.integer((sum(is.na(pacientes$DT_NOTIFICACAO))*100) / length(pacientes$DT_NOTIFICACAO))
```

```{r removerOutrasSindromes}
pacientes=pacientes[complete.cases(pacientes$CS_CLASSICACAO_FINAL) &
                    pacientes$CS_CLASSICACAO_FINAL==5,]
```

```{r qtdNotificacoesMes, include=FALSE}
#Preparando dadaframe para o gráfico de quantidade de notificações.
qtdNotificacoesMes = pacientes %>% 
  group_by(MES_NOTIFICACAO) %>%
  summarise(
    .groups = "drop_last",
    OCORRENCIAS=n()
  ) %>%
arrange(MES_NOTIFICACAO)
```

```{r grfDtNotificacao, include=FALSE}
#Exibir gráfico com o número de notificações por mês.
grfDtNotificacao=ggplot(qtdNotificacoesMes) + 
  aes(x=MES_NOTIFICACAO, y=OCORRENCIAS, fill=MES_NOTIFICACAO)  +
  geom_bar(stat = "identity", na.rm = F) +
  labs(x=NULL, y="Quantidade", fill = "Mês",
       title = NULL,
       subtitle = NULL) +
  scale_fill_manual(values = cores[14:1]) +
  theme_bw() +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen")) 
```

\qquad A partir deste processamento foi possível a criação do Gráfico 1 (Notificações de Covid-19 por Mês) e verificar que no Brasil, em 2020, os primeiros casos de covid-19 foram registrados em fevereiro e que, no mês de julho, ocorreu o maior número de casos.

```{r gridDtNotificacao, echo=FALSE}
grid.arrange(grfDtNotificacao, bottom="Gráfico 1: Notificações de Covid-19 por Mês")
```

\subsubsection{3.3.2 Idade}

\qquad No processamento da coluna NU_IDADE, atribuiu-se a média da idade nacional dos casos de covid-19, que é de 59 (cinquenta e nove) anos, nas ocorrências com valores superiores a 110 (cento e dez) anos. Essa transformação teve como objetivo minimizar os valores outliers e os prováveis erros de digitação. Conforme trecho de código abaixo:

\

```{r idade}
#Idades acima de 110 anos atribui a idade média. 
pacientes$NU_IDADE=as(pacientes$NU_IDADE, "integer");
pacientes[pacientes$NU_IDADE >110, ]$NU_IDADE =as.integer(mean(pacientes$NU_IDADE, na.rm = T))
```

\qquad Igualmente ao ocorrido no item anterior indentificou-se que não há valores omissos na coluna NU_IDADE.

```{r idadeOmisso, include=FALSE}
#Percentual valores omissos
as.integer((sum(is.na(pacientes$NU_IDADE))*100) / length(pacientes$NU_IDADE))
```

```{r grfIdade, include=FALSE}
grfIdade=ggplot(pacientes) + 
  aes(y=NU_IDADE, x=REGIAO, fill=REGIAO)  +
  geom_boxplot(na.rm = F) +
  labs(y="Idade", x=NULL, fill = "Estados",
       title = NULL,
       subtitle = NULL) +
  scale_fill_manual(values = cores) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 10),
        axis.title.x = element_text(size = 16),
  axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

\qquad Com base nesse processamento foi elaborado o Gráfico 2 (Boxplot de Idades dos casos graves de covid-19 por região), no qual fica evidênciado que:

\begin{itemize}
\item a região centro-oeste e a região nordeste apresentam respectivamente a menor e a maior média nacional de idade dos casos graves de covid-19;
\item existem outlier abaixo de 15 anos nas regiões nordeste, suldeste e sul;
\item aproximadamente 75% dos casos graves de covid-19 possuem idade acima dos 40 anos.
\end{itemize}

```{r gridIdade, echo=FALSE}
grid.arrange(grfIdade, bottom="Gráfico 2: Boxplot de Idades dos casos graves de covid-19 por região")
```

\newpage

\subsubsection{3.3.3 Raça}

\qquad Na coluna CS_RACA, os valores numéricos foram substituídos pelas strings correspondentes, conforme descrito no dicionário de dados disponível na seção anexo. Essas alterações são verificáveis no trecho de código a seguir:

\

```{r raca}
#Transformando domínios da coluna raça em valores mais significativos para o gráfico
pacientes[ complete.cases(pacientes$CS_RACA) & pacientes$CS_RACA==9,]$CS_RACA = NA
pacientes[ complete.cases(pacientes$CS_RACA) & pacientes$CS_RACA==1,]$CS_RACA = "Branca"
pacientes[ complete.cases(pacientes$CS_RACA) & pacientes$CS_RACA==2,]$CS_RACA = "Preta"
pacientes[ complete.cases(pacientes$CS_RACA) & pacientes$CS_RACA==3,]$CS_RACA = "Amarela"
pacientes[ complete.cases(pacientes$CS_RACA) & pacientes$CS_RACA==4,]$CS_RACA = "Parda"
pacientes[ complete.cases(pacientes$CS_RACA) & pacientes$CS_RACA==5,]$CS_RACA = "Indígina"
pacientes$CS_RACA = factor(pacientes$CS_RACA)
```

\qquad É importante destacar que, na coluna CS_RACA, o percentual de valores é de 22% (vinte e dois por cento). Esses valores foram removidos nas elaborações de gráficos e modelos de machine learning.

```{r racaOmisso, include=FALSE}
#Percentual valores omissos
as.integer((sum(is.na(pacientes$CS_RACA))*100) / length(pacientes$CS_RACA))
```

```{r grfRaca , include=FALSE}
grfRaca=ggplot(pacientes[complete.cases(pacientes$CS_RACA),]) + 
  aes(x=CS_RACA, fill=CS_RACA)  +
  geom_bar(na.rm = F) +
 labs(y="Ocorrência", x=NULL,  title = NULL, subtitle =
         NULL) +
  theme_bw() +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))+
  scale_fill_manual(values = c("#F2EEB3", "#ECDFBD", "#8C6954", "#59323C", "#3B3A35")) +
  labs(color = NULL) 
```

\qquad Este processamento possibilitou a construção do Gráfico 3 (Quantitativo dos casos graves de covid-19 por raça), revelando que:

\begin{itemize}
\item a raça com maior representatividade de casos graves de covid-19 é a branca seguida pela parda;
\item a raça indigina foi a que regsitrou menos casos;
\end{itemize}

```{r gridRaca, echo=FALSE}
grid.arrange(grfRaca, bottom="Gráfico 3: Quantitativo dos casos graves de covid-19 por raça")
```

\newpage

\subsubsection{3.3.4 Sexo}

\qquad O percentual de valores omissões na coluna CS_SEXO é de 0.01% (zero vírgula zero um por cento). Esses valores foram tratados a partir da coluna CS_GESTANTE, atribuiu-se sexo feminino, quando esta coluna informa existência de gestação. Em contrapartida, pra os valores omissões de sexo que não apresetam indicação de gestação, atribuiu-se sexo masculino, dado que a presença do sexo masculino é maior (vide Gráfico 4 abaixo) e a incidência de valores omissos é muito pequena.

\qquad Abaixo segue o trecho de código responsável por este processamento:

\

```{r sexoOmisso, include=FALSE}
#Percentual valores omissos
pacientes[pacientes$CS_SEXO=="I",]$CS_SEXO=NA
(sum(is.na(pacientes$CS_SEXO))*100) / length(pacientes$CS_SEXO)
```

```{r sexo}
pacientes[is.na(pacientes$CS_SEXO) & pacientes$CS_GESTANTE>4, ]$CS_SEXO="M"
pacientes[is.na(pacientes$CS_SEXO) & pacientes$CS_GESTANTE<=4, ]$CS_SEXO="F"
pacientes$CS_SEXO = factor(pacientes$CS_SEXO)
```

```{r gsexo, include=FALSE}
sexo=pacientes %>% 
group_by(CS_SEXO) %>%
summarise(.groups = "drop_last",
QTD=n()
) %>%
arrange(desc(QTD))
sexo[sexo$CS_SEXO=='M',"PERCENTUAL"]=round(sexo[sexo$CS_SEXO=='M', ]$QTD / sum(sexo$QTD), digits = 4) 
sexo[sexo$CS_SEXO=='F',"PERCENTUAL"]=round(sexo[sexo$CS_SEXO=='F', ]$QTD / sum(sexo$QTD), digits = 4) 

grSexo<- ggplot(sexo, aes(x="", y=PERCENTUAL, fill=CS_SEXO))+
geom_bar(width = 1, stat = "identity") + coord_polar("y", start=0) +
scale_fill_manual(values=c( "#ebabab", "#b3cce3" )) +
theme_bw()  +
theme(axis.title.x = element_blank(),
axis.title.y = element_blank(),
axis.text.x=element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(), plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))+
geom_text(aes(label = percent(PERCENTUAL)),  position = position_stack(vjust = 0.5) ) +
labs(x=NULL, y="Occorrência", fill = NULL, title = "Sexo") 
```

\qquad Com base neste processamento foi gerado o Gráfico 4 (Percentual dos casos graves de covid-19 por sexo), que destaca a maior incidência de casos graves de covid-19 no sexo masculino.

\

```{r grfSecao, echo=FALSE}
grid.arrange(grSexo,  bottom="Gráfico 4: Percentual dos casos graves de covid-19 por sexo")
```

\

\subsubsection{3.3.5 Comorbidades}

\qquad Nas colunas referente às comorbidades do paciente, foram convertidos os valores numéricos para as strings correspondentes, conforme descrito no dicionário de dados, disponível no Anexo B, deste trabalho. 

\qquad A coluna IN_FATOR_RISC, informa a existência de comorbidade no paciente. Nela não foram identificados valores omissos.

\qquad No trecho de código abaixo verifica-se parte do processamento realizado nas colunas referente a comorbidades.

\

```{r fatorRiscoOmisso, include=FALSE}
#Percentual valores omissos
(sum(is.na(pacientes$IN_FATOR_RISC))*100) / length(pacientes$IN_FATOR_RISC)
```

```{r comorbidade1}
#Puerpera
#Alterando domínios
pacientes[complete.cases(pacientes$IN_PUERPERA) & pacientes$IN_PUERPERA==9, ]$IN_PUERPERA=NA 
pacientes[complete.cases(pacientes$IN_PUERPERA) & pacientes$IN_PUERPERA==1, ]$IN_PUERPERA="Sim"
pacientes[complete.cases(pacientes$IN_PUERPERA) & pacientes$IN_PUERPERA==2, ]$IN_PUERPERA="Não"
pacientes$IN_PUERPERA=factor(pacientes$IN_PUERPERA)

#Cardiopatia
#Alterando domínios
pacientes[complete.cases(pacientes$IN_CARDIOPATI) &
pacientes$IN_CARDIOPATI==9, ]$IN_CARDIOPATI=NA    
pacientes[complete.cases(pacientes$IN_CARDIOPATI) &
pacientes$IN_CARDIOPATI==1, ]$IN_CARDIOPATI="Sim"
pacientes[complete.cases(pacientes$IN_CARDIOPATI) &
pacientes$IN_CARDIOPATI==2, ]$IN_CARDIOPATI="Não"
pacientes$IN_CARDIOPATI=factor(pacientes$IN_CARDIOPATI)
#Continua para todos os campos do grupo comorbidades...
```

```{r comorbidade2, include=FALSE}
#Hematologia
#Alterando domínios
pacientes[complete.cases(pacientes$IN_HEMATOLOGI) &
pacientes$IN_HEMATOLOGI==9, ]$IN_HEMATOLOGI=NA
pacientes[complete.cases(pacientes$IN_HEMATOLOGI) &
pacientes$IN_HEMATOLOGI==1, ]$IN_HEMATOLOGI="Sim"
pacientes[complete.cases(pacientes$IN_HEMATOLOGI) &
pacientes$IN_HEMATOLOGI==2, ]$IN_HEMATOLOGI="Não"
pacientes$IN_HEMATOLOGI=factor(pacientes$IN_HEMATOLOGI)

#Sindrome Down
#Alterando domínios
pacientes[complete.cases(pacientes$IN_SINDROME_DOWN) &
pacientes$IN_SINDROME_DOWN==9, ]$IN_SINDROME_DOWN=NA    
pacientes[complete.cases(pacientes$IN_SINDROME_DOWN) &
pacientes$IN_SINDROME_DOWN==1, ]$IN_SINDROME_DOWN="Sim"
pacientes[complete.cases(pacientes$IN_SINDROME_DOWN) &
pacientes$IN_SINDROME_DOWN==2, ]$IN_SINDROME_DOWN="Não"
pacientes$IN_SINDROME_DOWN=factor(pacientes$IN_SINDROME_DOWN)

#Doênça Hepatica
#Alterando domínios
pacientes[complete.cases(pacientes$IN_DOENCA_HEPATICA) &
pacientes$IN_DOENCA_HEPATICA==9, ]$IN_DOENCA_HEPATICA=NA  
pacientes[complete.cases(pacientes$IN_DOENCA_HEPATICA) &
complete.cases(pacientes$IN_DOENCA_HEPATICA) &
pacientes$IN_DOENCA_HEPATICA==1, ]$IN_DOENCA_HEPATICA="Sim"
pacientes[complete.cases(pacientes$IN_DOENCA_HEPATICA) &
complete.cases(pacientes$IN_DOENCA_HEPATICA) &
pacientes$IN_DOENCA_HEPATICA==2, ]$IN_DOENCA_HEPATICA="Não"
pacientes$IN_DOENCA_HEPATICA=factor(pacientes$IN_DOENCA_HEPATICA)

#Asma
#Alterando domínios
pacientes[complete.cases(pacientes$IN_ASMA) & pacientes$IN_ASMA==9, ]$IN_ASMA=NA   
pacientes[complete.cases(pacientes$IN_ASMA) & pacientes$IN_ASMA==1, ]$IN_ASMA="Sim"
pacientes[complete.cases(pacientes$IN_ASMA) & pacientes$IN_ASMA==2, ]$IN_ASMA="Não"
pacientes$IN_ASMA=factor(pacientes$IN_ASMA)

#Diabetes
#Alterando domínios
pacientes[complete.cases(pacientes$IN_DIABETES) & pacientes$IN_DIABETES==9, ]$IN_DIABETES=NA  
pacientes[complete.cases(pacientes$IN_DIABETES) & pacientes$IN_DIABETES==1, ]$IN_DIABETES="Sim"
pacientes[complete.cases(pacientes$IN_DIABETES) & pacientes$IN_DIABETES==2, ]$IN_DIABETES="Não"
pacientes$IN_DIABETES=factor(pacientes$IN_DIABETES)

#Doença Neurológica
#Alterando domínios
pacientes[complete.cases(pacientes$IN_DOENCA_NEUROLOGICA) &
pacientes$IN_DOENCA_NEUROLOGICA==9, ]$IN_DOENCA_NEUROLOGICA=NA     
pacientes[complete.cases(pacientes$IN_DOENCA_NEUROLOGICA) &
pacientes$IN_DOENCA_NEUROLOGICA==1, ]$IN_DOENCA_NEUROLOGICA="Sim"
pacientes[complete.cases(pacientes$IN_DOENCA_NEUROLOGICA) &
pacientes$IN_DOENCA_NEUROLOGICA==2, ]$IN_DOENCA_NEUROLOGICA="Não"
pacientes$IN_DOENCA_NEUROLOGICA=factor(pacientes$IN_DOENCA_NEUROLOGICA)

#Pneumopatia Crônica
#Alterando domínios
pacientes[complete.cases(pacientes$IN_PNEUMOPATIA_CRONICA) &
pacientes$IN_PNEUMOPATIA_CRONICA==9, ]$IN_PNEUMOPATIA_CRONICA=NA   
pacientes[complete.cases(pacientes$IN_PNEUMOPATIA_CRONICA) &
pacientes$IN_PNEUMOPATIA_CRONICA==1, ]$IN_PNEUMOPATIA_CRONICA="Sim"
pacientes[complete.cases(pacientes$IN_PNEUMOPATIA_CRONICA) &
pacientes$IN_PNEUMOPATIA_CRONICA==2, ]$IN_PNEUMOPATIA_CRONICA="Não"
pacientes$IN_PNEUMOPATIA_CRONICA=factor(pacientes$IN_PNEUMOPATIA_CRONICA)

#Imunodepressão
#Alterando domínios
pacientes[complete.cases(pacientes$IN_IMUNODEPRESSAO) &
pacientes$IN_IMUNODEPRESSAO==9, ]$IN_IMUNODEPRESSAO=NA 
pacientes[complete.cases(pacientes$IN_IMUNODEPRESSAO) &
pacientes$IN_IMUNODEPRESSAO==1, ]$IN_IMUNODEPRESSAO="Sim"
pacientes[complete.cases(pacientes$IN_IMUNODEPRESSAO) &
pacientes$IN_IMUNODEPRESSAO==2, ]$IN_IMUNODEPRESSAO="Não"
pacientes$IN_IMUNODEPRESSAO=factor(pacientes$IN_IMUNODEPRESSAO)

#Doênça Renal
#Alterando domínios
pacientes[complete.cases(pacientes$IN_DOENCA_RENAL) &
pacientes$IN_DOENCA_RENAL==9, ]$IN_DOENCA_RENAL=NA 
pacientes[complete.cases(pacientes$IN_DOENCA_RENAL) &
pacientes$IN_DOENCA_RENAL==1, ]$IN_DOENCA_RENAL="Sim"
pacientes[complete.cases(pacientes$IN_DOENCA_RENAL) &
pacientes$IN_DOENCA_RENAL==2, ]$IN_DOENCA_RENAL="Não"
pacientes$IN_DOENCA_RENAL=factor(pacientes$IN_DOENCA_RENAL)

#Obesidade
#Alterando domínios
pacientes[complete.cases(pacientes$IN_OBESIDADE) & pacientes$IN_OBESIDADE==9, ]$IN_OBESIDADE=NA
pacientes[complete.cases(pacientes$IN_OBESIDADE) & pacientes$IN_OBESIDADE==1, ]$IN_OBESIDADE="Sim"
pacientes[complete.cases(pacientes$IN_OBESIDADE) & pacientes$IN_OBESIDADE==2, ]$IN_OBESIDADE="Não"
pacientes$IN_OBESIDADE=factor(pacientes$IN_OBESIDADE)

#Preparando dataframe das comorbidades para o gráfico
comorbidades = setNames(data.frame(matrix(ncol = 1, nrow = 0)),c("CS_COMORBIDADE"))
comorbidade = setNames(data.frame(rep("Cardiopatia",
length(pacientes[complete.cases(pacientes$IN_CARDIOPATI) &
pacientes$IN_CARDIOPATI=="Sim", ]$IN_CARDIOPATI))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Diabetes",
length(pacientes[complete.cases(pacientes$IN_DIABETES) &
pacientes$IN_DIABETES=="Sim", ]$IN_DIABETES))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Pneupatia Crônica",
length(pacientes[complete.cases(pacientes$IN_PNEUMOPATIA_CRONICA) &                              
pacientes$IN_PNEUMOPATIA_CRONICA=="Sim", ]$IN_PNEUMOPATIA_CRONICA))),
c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Doença Neurológica",
length(pacientes[complete.cases(pacientes$IN_DOENCA_NEUROLOGICA) &
pacientes$IN_DOENCA_NEUROLOGICA=="Sim", ]$IN_DOENCA_NEUROLOGICA))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Obesidade",
length(pacientes[complete.cases(pacientes$IN_OBESIDADE) &
pacientes$IN_OBESIDADE=="Sim", ]$IN_OBESIDADE))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Doença Renal",
length(pacientes[complete.cases(pacientes$IN_DOENCA_RENAL) &
pacientes$IN_DOENCA_RENAL=="Sim", ]$IN_DOENCA_RENAL))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Asma",
length(pacientes[complete.cases(pacientes$IN_ASMA) &
pacientes$IN_ASMA=="Sim", ]$IN_ASMA))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Imunodepressão",
length(pacientes[complete.cases(pacientes$IN_IMUNODEPRESSAO) &
pacientes$IN_IMUNODEPRESSAO=="Sim", ]$IN_IMUNODEPRESSAO))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Hepatologia",
length(pacientes[complete.cases(pacientes$IN_DOENCA_HEPATICA) &
pacientes$IN_DOENCA_HEPATICA=="Sim", ]$IN_DOENCA_HEPATICA))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Hematologia",
length(pacientes[complete.cases(pacientes$IN_HEMATOLOGI) &
pacientes$IN_HEMATOLOGI=="Sim", ]$IN_HEMATOLOGI))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Puerpera",
length(pacientes[complete.cases(pacientes$IN_PUERPERA) &
pacientes$IN_PUERPERA=="Sim", ]$IN_PUERPERA))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidade = setNames(data.frame(rep("Síndorme de Down",
length(pacientes[complete.cases(pacientes$IN_SINDROME_DOWN) &
pacientes$IN_SINDROME_DOWN=="Sim", ]$IN_SINDROME_DOWN))),c("CS_COMORBIDADE"))
comorbidades = rbind(comorbidades, comorbidade)
comorbidades$CS_COMORBIDADE = factor(comorbidades$CS_COMORBIDADE)
```

```{r tblComorbidades, include=FALSE}
comorbidades %>% 
  group_by(CS_COMORBIDADE) %>%
  summarise(
    .groups = "drop_last",
    OCORRENCIAS=n()
  ) %>%
arrange(desc(OCORRENCIAS))
```

```{r grfComorbidades, include=FALSE}
grfComorbidades = ggplot(comorbidades) + 
  aes(x=CS_COMORBIDADE, fill=CS_COMORBIDADE)  +
  geom_bar(na.rm = F) +
  labs(x=NULL, y="Occorrência", fill = "Comorbidade", title = NULL,
       subtitle = NULL) +
  scale_fill_manual(values = cores[12:1]) +
  theme_bw() +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

\qquad Com base no processamento acima foi possível gerar o Gráfico 5 (Comorbidades preexistentes nos casos graves de covid-19) no qual verifica-se a maior incidência de comobridades referente a cardiopatias e diabetes.

```{r gridComorbidades, echo=FALSE, fig.height=3, fig.width=7}
grid.arrange(grfComorbidades, bottom="Gráfico 5: Comorbidades preexistentes nos casos graves de covid-19")
```

\

\subsubsection{3.3.6 Recursos do tratamento}

\qquad Nesta seção constam os recursos que foram utilizados pelo paciente durante o tratamento. Os recurso são: se o paciente precisou de oxigênio, se precisou de suporte de ventilação pulmonar, se foi pra UTI, se tomou algum antiviral ou se foi hospitalizado.

\qquad Ressalta-se que a coluna mais utilizada deste grupo foi a IN_HOSPITALIZADO, cujo percentual de valores omissos é de 2.61% (dois virgula sessenta e um por cento), estes valores foram removidos na geração dos gráficos e modelos de machine learning.

```{r recursosOmissos, include=FALSE}
#Percentual valores omissos
pacientes[complete.cases(pacientes$CS_SUPORTE_VENTILATORIO) &
  pacientes$CS_SUPORTE_VENTILATORIO==9,]$CS_SUPORTE_VENTILATORIO=NA
(sum(is.na(pacientes$CS_SUPORTE_VENTILATORIO))*100) / length(pacientes$CS_SUPORTE_VENTILATORIO)

pacientes[complete.cases(pacientes$IN_USOU_ANTIVIRAL) &     
  pacientes$IN_USOU_ANTIVIRAL==9,]$IN_USOU_ANTIVIRAL=NA
(sum(is.na(pacientes$IN_USOU_ANTIVIRAL))*100) / length(pacientes$IN_USOU_ANTIVIRAL)

pacientes[complete.cases(pacientes$IN_HOSPITALIZADO) &
  pacientes$IN_HOSPITALIZADO==9,]$IN_HOSPITALIZADO=NA
(sum(is.na(pacientes$IN_HOSPITALIZADO))*100) / length(pacientes$IN_HOSPITALIZADO)

pacientes[complete.cases(pacientes$IN_UTI) & pacientes$IN_UTI==9,]$IN_UTI=NA
(sum(is.na(pacientes$IN_UTI))*100) / length(pacientes$IN_UTI)
```

\qquad Nas colunas referente a recursos do tratamento do paciente, foram convertidos os valores numéricos para as strings correspondentes, conforme descrito no dicionário de dados, disponível no Anexo B, deste trabalho, conforme trecho de código abaixo.

```{r recursos1}
#Usou Suporte Ventilatório Invasivo / Não Invasivo
#Foi Hospitalizado
#Alterando domínios
pacientes[complete.cases(pacientes$IN_HOSPITALIZADO) &
  pacientes$IN_HOSPITALIZADO==1, ]$IN_HOSPITALIZADO="Sim"
pacientes[complete.cases(pacientes$IN_HOSPITALIZADO) &
  pacientes$IN_HOSPITALIZADO==2, ]$IN_HOSPITALIZADO="Não"
pacientes$IN_HOSPITALIZADO=factor(pacientes$IN_HOSPITALIZADO)
#Continua para os demais campos...
```

```{r recursos2, include=F}

#Alterando domínios
pacientes[complete.cases(pacientes$CS_SUPORTE_VENTILATORIO) &
  pacientes$CS_SUPORTE_VENTILATORIO==1, ]$CS_SUPORTE_VENTILATORIO="Sim, (INVASIVO)"
pacientes[complete.cases(pacientes$CS_SUPORTE_VENTILATORIO) &
  pacientes$CS_SUPORTE_VENTILATORIO==2, ]$CS_SUPORTE_VENTILATORIO="Sim, (NÃO INVASIVO)"
pacientes[complete.cases(pacientes$CS_SUPORTE_VENTILATORIO) &
  pacientes$CS_SUPORTE_VENTILATORIO==3, ]$CS_SUPORTE_VENTILATORIO="Não"
pacientes$CS_SUPORTE_VENTILATORIO=factor(pacientes$CS_SUPORTE_VENTILATORIO)

#Usou Antiviral
#Alterando domínios
pacientes[complete.cases(pacientes$IN_USOU_ANTIVIRAL) &
  pacientes$IN_USOU_ANTIVIRAL==1, ]$IN_USOU_ANTIVIRAL="Sim"
pacientes[complete.cases(pacientes$IN_USOU_ANTIVIRAL) &
  pacientes$IN_USOU_ANTIVIRAL==2, ]$IN_USOU_ANTIVIRAL="Não"
pacientes$IN_USOU_ANTIVIRAL=factor(pacientes$IN_USOU_ANTIVIRAL)

#Foi para UTI
#Alterando domínios
pacientes[complete.cases(pacientes$IN_UTI) & pacientes$IN_UTI==1, ]$IN_UTI="Sim"
pacientes[complete.cases(pacientes$IN_UTI) & pacientes$IN_UTI==2, ]$IN_UTI="Não"
pacientes$IN_UTI=factor(pacientes$IN_UTI)

#Preparando dataframe dos recursos para o gráfico
recursos = setNames(data.frame(matrix(ncol = 1, nrow = 0)),c("CS_RECURSO"))
recurso = setNames(data.frame(rep("Hospitalizado",
  length(pacientes[complete.cases(pacientes$IN_HOSPITALIZADO) &
  pacientes$IN_HOSPITALIZADO=="Sim", ]$IN_HOSPITALIZADO))),c("CS_RECURSO"))
recursos = rbind(recursos, recurso)
recurso = setNames(data.frame(rep("Oxigênio não Invasivo",
  length(pacientes[complete.cases(pacientes$CS_SUPORTE_VENTILATORIO) &
  pacientes$CS_SUPORTE_VENTILATORIO=="Sim, (NÃO INVASIVO)", ]$CS_SUPORTE_VENTILATORIO))),
  c("CS_RECURSO"))
recursos = rbind(recursos, recurso)
recurso = setNames(data.frame(rep("UTI",length(pacientes[complete.cases(pacientes$IN_UTI) &
  pacientes$IN_UTI=="Sim", ]$IN_UTI))),c("CS_RECURSO"))
recursos = rbind(recursos, recurso)
recurso = setNames(data.frame(rep("Ventilação Invasiva",
  length(pacientes[complete.cases(pacientes$CS_SUPORTE_VENTILATORIO) &
  pacientes$CS_SUPORTE_VENTILATORIO=="Sim, (INVASIVO)", ]$CS_SUPORTE_VENTILATORIO))),
c("CS_RECURSO"))
recursos = rbind(recursos, recurso)
recurso = setNames(data.frame(rep("Antiviral",
  length(pacientes[complete.cases(pacientes$IN_USOU_ANTIVIRAL) &
  pacientes$IN_USOU_ANTIVIRAL=="Sim", ]$IN_USOU_ANTIVIRAL))),c("CS_RECURSO"))
recursos = rbind(recursos, recurso)
recursos$CS_RECURSO = factor(recursos$CS_RECURSO)
```

```{r tblRecursos, include=FALSE}
recursos %>% 
  group_by(CS_RECURSO) %>%
  summarise(.groups = "drop_last",
    OCORRENCIAS=n()
  ) %>%
arrange(desc(OCORRENCIAS))
```

```{r grfRecursos, include=FALSE}
grfRecursos=ggplot(recursos) + 
  aes(x=CS_RECURSO, fill=CS_RECURSO)  +
  geom_bar(na.rm = F) +
  labs(x=NULL, y="Occorrência", fill = "Recursos", title = NULL,
       subtitle = NULL) +
  scale_fill_manual(values = cores[12:1]) +
  theme_bw() +
  theme(axis.text.x = element_blank(), axis.ticks.x = element_blank(),
  axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

\qquad Esse processamento permitiu a elaboração do Gráfico 6 (Recursos utilizados nos casos graves de covid-19), do qual concluí-se que aproximadamente metade dos pacientes hospitalizados precisaram de oxigêncio não invasivo.

```{r gridRecursos, echo=FALSE}
grid.arrange(grfRecursos, bottom="Gráfico 6: Recursos utilizados nos casos graves de covid-19")
```

\

\subsubsection{3.3.7 Evolução}

\qquad Na coluna CS_EVOLUCAO, os valores numéricos foram convertidos para as strings correspondentes, conforme descrito no dicionário de dados, disponível no Anexo B, deste trabalho. 

\qquad O percentual de valores omissos nesta coluna é de 12.31%, os quais foram removidos na eloboração dos gráficos e modelos de machine learning.

```{r evolucaoOmissos, include=FALSE}
pacientes[complete.cases(pacientes$CS_EVOLUCAO) &
  pacientes$CS_EVOLUCAO==9,]$CS_EVOLUCAO=NA
(sum(is.na(pacientes$DT_EVOLUCAO))*100) / length(pacientes$DT_EVOLUCAO)
```

\qquad O trecho de código a baixo reflete o processamento desta coluna.
\
```{r evolucao1}
#Data Evolução / Desfecho
pacientes$DT_EVOLUCAO = as.Date(pacientes$DT_EVOLUCAO, format="%d/%m/%Y")
pacientes["SEMANA_EVOLUCAO"] =  format(pacientes$DT_EVOLUCAO, "%U");
pacientes$SEMANA_EVOLUCAO=as.integer(pacientes$SEMANA_EVOLUCAO)
#Resultado Evolução / Desfecho
pacientes[complete.cases(pacientes$CS_EVOLUCAO) & pacientes$CS_EVOLUCAO==1, ]$CS_EVOLUCAO="Cura"
pacientes[complete.cases(pacientes$CS_EVOLUCAO) & pacientes$CS_EVOLUCAO==2, ]$CS_EVOLUCAO="Óbito"
pacientes[complete.cases(pacientes$CS_EVOLUCAO) &
  pacientes$CS_EVOLUCAO==3, ]$CS_EVOLUCAO="Óbito por outras causas"
pacientes$CS_EVOLUCAO=factor(pacientes$CS_EVOLUCAO)
```

```{r evolucao2, include=FALSE}
#Preparando dataframe de evolução para o gráfico
evolucao = setNames(data.frame(matrix(ncol = 1, nrow = 0)),c("CS_RESULTADO"))
resultado = setNames(data.frame(rep("Cura",length(pacientes[complete.cases(pacientes$CS_EVOLUCAO) &
pacientes$CS_EVOLUCAO=="Cura", ]$CS_EVOLUCAO))),c("CS_RESULTADO"))
evolucao = rbind(evolucao, resultado)
resultado = setNames(data.frame(rep("Óbito",length(pacientes[complete.cases(pacientes$CS_EVOLUCAO) &
pacientes$CS_EVOLUCAO=="Óbito", ]$CS_EVOLUCAO))),c("CS_RESULTADO"))
evolucao = rbind(evolucao, resultado)
resultado = setNames(data.frame(rep("Óbito por outras causas",
  length(pacientes[complete.cases(pacientes$CS_EVOLUCAO) &
  pacientes$CS_EVOLUCAO=="Óbito por outras causas", ]$CS_EVOLUCAO))),c("CS_RESULTADO"))
evolucao = rbind(evolucao, resultado)
evolucao$CS_RESULTADO = factor(evolucao$CS_RESULTADO)
```

```{r tblEvolucao, include=FALSE}
evolucao %>% 
  group_by(CS_RESULTADO) %>%
  summarise(.groups = "drop_last",
    OCORRENCIAS=n()
  ) %>%
arrange(desc(OCORRENCIAS))
```

```{r grfEvolucao, include=FALSE}
grfEvolucao = ggplot(evolucao) + 
  aes(x=CS_RESULTADO, fill=CS_RESULTADO)  +
  geom_bar(na.rm = F) +
  labs(x=NULL, y="Ocorrência", fill = "Resultado", title = NULL,
  subtitle = NULL) +
  scale_fill_manual(values = coresEvolucao) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 10), axis.title.x = element_text(size = 16),
  axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

\qquad A partir desse processamento foi elaborado o Gráfico 7 (Evolução dos casos graves de covid-19), do qual concluí-se que, aproximadamente, 1/3 (um terço) dos pacientes graves de covid-19 evoluem para óbito.

```{r gridEvolucao, echo=FALSE}
grid.arrange(grfEvolucao, bottom="Gráfico 7: Evolução dos casos graves de covid-19")
```

\newpage

\section{4. Análise Exploratória}

\

\qquad Neste capítulo, serão detalhadas as taxas de mortalidade e letalidada, bem como o número de mortes absolutos decorrentes de covid-19 no Brasil, em 2020. É importante observar que essa analise utilizou a tecnica de drill down, detalhando as informações até o nível de capitais.

\qquad Com intuido de facilitar as analises presente neste capitulo, torna-se necessário nivelar alguns conceitos, tais como: taxas de mortalidade e letalidade.

\qquad A taxa de mortalidade é a razão entre o número total de óbitos e o total da população vezes uma constante utilizada como unidade de medida, neste trabalho será adotado 1.000.000 (um milhão) de habitantes.

\qquad Já a taxa de letalidade é a razão entre o número total de óbitos e o número total de casos graves. 

\qquad Essas taxas foram calculadas exclusivamente a partir dos casos graves de covid-19. Deve-se relembrar que, para este trabalho, considera-se casos graves de covid-19 aqueles presente no arquivo CSV do OpenDataSUS. 

\

\subsection{4.1 Número absoluto de mortes de covid-19 no Brasil}

\qquad No ano de 2020, o Brasil teve 187.727 (cento e oitenta e sete mil e setecentos e vinte e sete) mortes por covid-19. Neste sentido, o Sudeste apresentou quase a metade dos casos de mortes por covid-19 do país, com 88.362 (oitenta e oito mil e trezentos e sessenta e duas) mortes. As demais regiões registraram juntas um número de mortes um pouco superior, totalizando 99.365 (noventa e nove mil e trezentos e sessenta e cinco) mortes, o que representa 52,93% (cinquenta e dois vírgula noventa e três por cento) do total de óbitos registrados no país por covid-19.

\qquad A este respeito, o Gráfico 8 (Mortes de covid-19 por região) apresenta a distribuição das mortes decorrente de covid-19, de forma regionalizada, conforme pode ser visto abaixo:

```{r mortesPorRegiao, include=FALSE}
mortesPorRegiao=pacientes[complete.cases(pacientes[,c("CS_EVOLUCAO")]) & pacientes$CS_EVOLUCAO=="Óbito",] %>% 
group_by(REGIAO) %>%
summarise(.groups = "drop_last", QTD_MORTES=n()) %>%
arrange(desc(QTD_MORTES))
```

```{r grfMortePorRegiao, include=FALSE}
#Exibir gráfico com quantidade de mortes por região
grdMortesPorRegiao = ggplot(mortesPorRegiao) + 
aes(x=REGIAO, y=QTD_MORTES, fill=REGIAO)  +
geom_bar(stat = "identity", na.rm = F) +
labs(x=NULL, y=NULL, fill = "Região", title = NULL, subtitle = NULL) +
scale_fill_manual(values = cores) + theme_bw() +
theme(axis.text.x = element_text(size = 10), axis.title.x = element_text(size = 16),
axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

```{r grdMortesPorRegiao, echo=FALSE, fig.height=4, fig.width=7}
grid.arrange(grdMortesPorRegiao, bottom="Gráfico 8: Mortes de covid-19 por região")
```

\qquad Após a região sudeste, o Nordeste aparece como a segunda região com maior número de mortes do Brasil, totalizando 44.965 (quarenta e quatro mil e novecentos e sessenta e cinco) mortes, ou seja, 23,95% (vinte e três vírgula noventa e cinco por cento) do total de mortes por covid-19 do país.

```{r mortesPorRegiaoSudeste, include=FALSE}
mortesPorRegiaoSudeste=pacientes[complete.cases(pacientes[,c("CS_EVOLUCAO")]) & pacientes$CS_EVOLUCAO=="Óbito" &
pacientes$REGIAO=="Sudeste",] %>% 
group_by(SG_UF) %>%
summarise(.groups = "drop_last", QTD_MORTES=n()) %>%
arrange(desc(QTD_MORTES))
```

```{r percentualMortesSP, include=FALSE}
mortesPorRegiaoSudeste[mortesPorRegiaoSudeste$SG_UF=="SP",]$QTD_MORTES / sum(mortesPorRegiaoSudeste$QTD_MORTES)
```

```{r grfMortePorRegiaoSudeste, include=FALSE}
#Exibir gráfico com quantidade de mortes por região
grdMortesPorRegiaoSudeste = ggplot(mortesPorRegiaoSudeste) + 
aes(x=SG_UF, y=QTD_MORTES, fill=SG_UF)  + geom_bar(stat = "identity", na.rm = F) +
labs(x=NULL, y=NULL, fill = "UF/Sudeste", title = NULL, subtitle = NULL) +
scale_fill_manual(values = coresSudeste) +theme_bw() +
theme(axis.text.x = element_text(size = 10), axis.title.x = element_text(size = 16),
axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

\qquad No Sudeste, o Estado de São Paulo foi responsável por 53,45% (cinquenta e três virgula quarenta e cinco por cento) das mortes, registrando 47.226 (quarenta e sete mil duzentos e vinte e seis) óbitos, ou seja, mais da metade das mortes na região, como pode ser visto no gráfico 9 (Mortes por covid-19 na região Sudeste) apresentado abaixo:

```{r grdMortesPorRegiaoSudeste, echo=FALSE, fig.height=3, fig.width=7}
grid.arrange(grdMortesPorRegiaoSudeste, bottom="Gráfico 9: Mortes por covid-19 na região Sudeste")
```

```{r mortesPorRegiaoNordeste, include=FALSE}
mortesPorRegiaoNordeste=pacientes[complete.cases(pacientes[,c("CS_EVOLUCAO")]) & pacientes$CS_EVOLUCAO=="Óbito" &
pacientes$REGIAO=="Nordeste",] %>% 
group_by(SG_UF) %>%
summarise(.groups = "drop_last", QTD_MORTES=n()) %>%
arrange(desc(QTD_MORTES))
mortesPorRegiaoNordeste
```

```{r grfMortePorRegiaoNordeste, include=FALSE}
#Exibir gráfico com quantidade de mortes por região
grdMortesPorRegiaoNordeste = ggplot(mortesPorRegiaoNordeste) + 
aes(x=SG_UF, y=QTD_MORTES, fill=SG_UF)  + geom_bar(stat = "identity", na.rm = F) +
labs(x=NULL, y=NULL, fill = "UF/Nordeste", title = NULL, subtitle = NULL) +
scale_fill_manual(values = coresNordeste) +theme_bw() +
theme(axis.text.x = element_text(size = 10), axis.title.x = element_text(size = 16),
axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

\qquad É importante observarmos que o Estado de São Paulo apresenta mais mortes do que a região nordeste inteira, que é a segunda maior região com casos de morte por covid-19 no país.

\qquad No que se refere ao Nordeste, o Estado do Ceará apresenta, aproximadamente, 1/4 (um quarto) do número de óbitos, no total de 10.281 (dez mil duzentos e oitenta e um) óbitos, seguido por Pernambuco e Bahia, com 9.597 (nove mil quinhentos e noventa e sete) e 8.321 (oito mil trezentos e vinte e um) óbitos, respectivamente. Esses três estados, juntos, têm quase 60% (sessenta por cento) das mortes por covid-19 no Nordeste. Sobre este assunto, o Gráfico 10 (Mortes por covid-19 na região Nordeste),  exibido abaixo, apresenta a distribuição de mortes por covid-19 na região.

```{r grdMortesPorRegiaoNordeste, echo=FALSE, fig.height=3, fig.width=7}
grid.arrange(grdMortesPorRegiaoNordeste, bottom="Gráfico 10: Mortes por covid-19 na região Nordeste")
```

\newpage

\subsection{4.2 Taxa de mortalidade da covid-19 no Brasil}

\qquad Apesar do estado de São Paulo liderar o números de mortes absoluto por covid-19 no Brasil, em relação ao tamanho da população, a situação é diferente. Verifica-se que 5 (cinco) estados do país ultrapassam São Paulo em mortes por milhão de habitantes. O Rio de Janeiro é o estado com a mais alta taxa de mortalidade do país, seguido pelo Distrito Federal. Para desmostrar segue a Tabela \underline{\color{blue}\ref{tab:txMortalidade}}.

\begin{table}[htp!]
\center
\begin{tabular}{|c|c|c|c|c|c|} \hline
RJ & DF & AM & CE & SE & SP \\ \hline
1.470 & 1.439 & 1.254 & 1.119 & 1.110 & 1.020 \\ \hline
\end{tabular}
\caption{Estados com maiores taxas de mortalidade por milhão de habitantes}
\label{tab:txMortalidade}
\end{table}

\qquad Apesar da Tabela \underline{\color{blue}\ref{tab:txMortalidade}} apresentar apenas os 6 (seis) estados com as maiores taxas de mortalidade, pode-se visualizar no Gráfico 11 o mapa de calor das taxas de mortalidade por estado. De forma complementar, tem-se, ainda, a tabela completa com as taxas de mortalidade por covid-19 de todos os estados disponível no Apêndice A.

```{r mortalidadePorUF, include=FALSE}
mortalidadePorUF=pacientes[complete.cases(
pacientes[,c("CS_EVOLUCAO")]) &
pacientes$CS_EVOLUCAO=="Óbito",] %>% 
group_by(SG_UF) %>%
summarise(.groups = "drop_last",
QTD_MORTES=n()
) %>%
arrange(desc(QTD_MORTES))
taxaDeMortalidadePorRegiao = mortalidadePorUF %>% left_join(estadoIBGE, c("SG_UF" = "SG_UF"))
#Taxa de Mortalidade por Milhão de habitantes
taxaDeMortalidadePorRegiao$TX_MORTALIDADE=(taxaDeMortalidadePorRegiao$QTD_MORTES / taxaDeMortalidadePorRegiao$NU_POPULACAO) * 1000000
taxaDeMortalidadePorRegiao$TX_MORTALIDADE = as(taxaDeMortalidadePorRegiao$TX_MORTALIDADE, "integer")
taxaDeMortalidadePorRegiao = taxaDeMortalidadePorRegiao[order(taxaDeMortalidadePorRegiao$TX_MORTALIDADE,
decreasing = T),]
sfEstados <- inner_join(estados, taxaDeMortalidadePorRegiao, by = c("abbrev_state" = "SG_UF"))
```

```{r estadosTxMortalidade, include=FALSE}
#Selecionar os 10 estados com a maior taxa de mortalidade
labelEstados = sfEstados[c("3", "19", "27", "10", "15", "20"),]
labelEstados_points <- st_point_on_surface(labelEstados)
labelEstados_coords <- as.data.frame(st_coordinates(labelEstados_points))
labelEstados_coords$SG_UF <- labelEstados$abbrev_state
```

```{r grfTxMortalidade, include=FALSE}
#Plotar o gráfico nacional.
grfTxMortalidade = ggplot() +
  geom_sf(data=sfEstados, aes(fill=TX_MORTALIDADE), size=.15, color="red") +
  geom_text(data = labelEstados_coords, aes(X, Y, label = SG_UF), colour = "darkgreen") +
  labs(fill = "Mortalidade", title = NULL,
  subtitle = NULL) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 10), axis.title.x = element_blank(),
  axis.text.y = element_text(size = 14), axis.title.y =element_blank()  ,
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))+
  scale_fill_gradient(low = "white", high = "#DC143C")
```

```{r gridTaxaMortalidade, echo=FALSE, fig.height=4, fig.width=7}
grid.arrange(grfTxMortalidade, bottom="Gráfico 11: Mapa de calor das taxas de mortalidade por milhão de habitantes")
```
\qquad No que se refere as capitais brasileiras, as taxas de mortalidade são ainda maiores que as estaduais. A média da taxa de mortalidade nas capitais é de 1.689 (um mil seiscentos e oitenta e nove) óbitos por milhão de habitantes, superior ao Estado do Rio de Janeiro, Estado com maior taxa de mortalidade do país (veja Tabela \underline{\color{blue}\ref{tab:txMortalidade}}).

\qquad Recife é a capital com maior número de mortes por milhão de habitantes, com 3.313 (três mil trezentos de treze) óbitos por covid-19, o que representa uma taxa 96% (noventa e seis por cento) superior à média nacional das capitais. 

\qquad Das 7 (sete) maiores taxas de mortalidade por covid-19 nas capitais as regiões norte e nordeste ocupam 6 posições no ranking, com exceção da cidade do Rio de Janeiro. Já o município de São Paulo tem taxa de mortalidade inferior a média nacional e ocupa a 19ª (décima nona) posição do ranking, com 1.436 mortes por milhão de habitantes, esse raking consta na Tabela \underline{\color{blue}\ref{tab:txMortalidadeCapitais}} abaixo. 

\begin{table}[htp!]
\center
\begin{tabular}{|c|c|c|c|c|c|c|} \hline
Recife & Rio de Janeiro & Aracaju & Belém & Fortaleza & Teresina & João Pessoa \\ \hline
3313 & 2556 & 2472 & 2175 & 2126 & 1999 & 1913\\ \hline
\end{tabular}
\caption{Capitais com maiores taxas de mortalidade}
\label{tab:txMortalidadeCapitais}
\end{table}

```{r capitaisBrasil, include=FALSE}
codCapitais= c(2800308, 1501402, 3106200, 1400100, 5300108, 5002704, 2408102, 5103403,
               4106902, 4205407, 2304400, 5208707, 2507507, 1600303, 2704302,
               1302603, 1721000, 4314902, 1100205, 2611606, 1200401, 3304557, 
               2927408, 2111300, 3550308, 2211001, 3205309)
capitais = matrix(data = NA, nrow = 27, ncol = 1, byrow = TRUE)
capitais=data.frame(capitais);
colnames(capitais)= c("COD_MUNICIPIO")
capitais$COD_MUNICIPIO=codCapitais
capitaisPopulacao <- inner_join(municipiosIBGE, capitais, by = c("COD_MUNICIPIO" = "COD_MUNICIPIO"))
```

```{r mortesPorCapitais, include=FALSE}
mortesPorCapitais=pacientes[complete.cases(pacientes[,c("CS_EVOLUCAO")]) & pacientes$CS_EVOLUCAO=="Óbito",] %>% 
filter(COD_MUNICIPIO %in% capitaisPopulacao$COD_MUNICIPIO6) %>%
group_by(COD_MUNICIPIO) %>%
summarise(.groups = "drop_last", QTD_MORTES=n()) %>%
arrange(desc(QTD_MORTES))
taxaDeMortalidadePorCapitais = mortesPorCapitais %>% inner_join(municipiosIBGE, c("COD_MUNICIPIO" = "COD_MUNICIPIO6"))
#Taxa de Mortalidade por Milhão de habitantes
taxaDeMortalidadePorCapitais$TX_MORTALIDADE=(taxaDeMortalidadePorCapitais$QTD_MORTES / taxaDeMortalidadePorCapitais$NU_POPULACAO) * 1000000
taxaDeMortalidadePorCapitais$TX_MORTALIDADE = as(taxaDeMortalidadePorCapitais$TX_MORTALIDADE, "integer")
taxaDeMortalidadePorCapitais = taxaDeMortalidadePorCapitais[order(taxaDeMortalidadePorCapitais$TX_MORTALIDADE,
decreasing = T),]
sfCapitais <- inner_join(municipios, taxaDeMortalidadePorCapitais, by = c("code_muni" = "COD_MUNICIPIO.y"))
taxaDeMortalidadePorCapitais
```

```{r meanCapitais, include=FALSE}
mediaCapitais=mean(taxaDeMortalidadePorCapitais$TX_MORTALIDADE)
mediaCapitais
taxaMortalidadeRecife=taxaDeMortalidadePorCapitais[taxaDeMortalidadePorCapitais$MUNICIPIO=="Recife", ]$TX_MORTALIDADE
proporcRecifeVsMediaNacional=taxaMortalidadeRecife/mediaCapitais
```

```{r grfTxMortalidadeCap, include=FALSE}
#Plotar o gráfico nacional.
  grfTxMortalidadeCap = ggplot() +
  geom_sf(data=sfEstados,  size=.15, color="green") +
  geom_sf(data=st_centroid(sfCapitais), aes(size=TX_MORTALIDADE), show.legend = "point", inherit.aes = FALSE, color="#DC143C", shape=25) +
  labs(size="Taxa Mortalidade", fill = "Mortalidade", title = NULL,
  subtitle = NULL) +
  theme_bw() +
  theme(axis.text.x = element_text(size = 10), axis.title.x = element_blank(),
  axis.text.y = element_text(size = 14), axis.title.y =element_blank()  ,
  plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

\qquad As taxas de mortlidade das capitais por covid-19 estão representadas em forma geométrica de triangulo invertido no Grafico 12 (Taxa de mortalidade por covid-19 nas capitais), sendo o maior trinangulo, a maior taxa de mortalidade, pondendo-se, ainda, visualizar mais detalhes das taxas de mortalidade por covid-19 nas capitais no Apêndice A, deste trabalho.

```{r gridTxMortalidadeCap, echo=FALSE}
grid.arrange(grfTxMortalidadeCap, bottom="Gráfico 12: Taxa de mortalidade por covid-19 nas capitais")
```

\subsection{4.3 Taxa de letalidade da covid-19 no Brasil}

\qquad A taxa de letalide de covid-19 no Brasil, com verificação a partir de teste de hipótese, é de 35% (trinca e cinco por cento), com nível de significancia de 95% (noventa e cinco por cento). Para este teste, utilizou-se uma amostra com 493.035 (quatrocentos e noventa e três mil e trinta e cinco) pacientes hospitalizados. Esta taxa coincide com a identificada no estudo realizado no Reino Unido, no qual comparou-se a taxa de letalidade da covid-19 com a do vírus ebola. A seguir, verifica-se o trecho de código para realização do teste de hipotese:


```{r preTestHipotese, include=FALSE}
#Taxa de Letalidade Geral
pacientesCovidTxLetalidade=pacientes[complete.cases(pacientes[,c(
"CS_EVOLUCAO","IN_HOSPITALIZADO")]) &
pacientes$IN_HOSPITALIZADO=="Sim" & pacientes$CS_EVOLUCAO!="Óbito por outras causas",]
```

```{r testHipotese}
qtdObitos=dim(pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$CS_EVOLUCAO=="Óbito",])[1]
totalPacientes=dim(pacientesCovidTxLetalidade[,])[1]
prop.test(qtdObitos, totalPacientes, 0.35, conf.level = 0.95)
```
\newpage

\qquad A figura \underline{\color{blue}\ref{fig:Gallagher2020}} mostra a manchete da matéria da BBC NEWS, que faz referência ao estudo Britânico citado acima.

\begin{figure}[htp]
\center
\includegraphics[width=0.7\linewidth]{anexos/Gallagher2020.png}
\caption{Matéria BBC NEWS}
\label{fig:Gallagher2020}
\end{figure}

\qquad De acordo com James Gallagher (2020), repórter de ciência e saúde\cite{Gallagher:2020}:

\
\
\begin{flushright}
\begin{minipage}{0.7\linewidth}
\begin{footnotesize} 
Pessoas internadas em hospitais por conta do novo coronavírus têm a mesma probabilidade de morrer do que aquelas hospitalizadas pelo vírus do ebola, segundo nova pesquisa conduzida no Reino Unido.
\end{footnotesize}
\end{minipage}
\end{flushright}
\
\

\newpage
```{r dfTxLetalidade, include=FALSE}
pacientesCovidTxLetalidade = pacientesCovidTxLetalidade[ complete.cases(pacientesCovidTxLetalidade$SEMANA_EVOLUCAO),]
sumariopacientesCovid = pacientesCovidTxLetalidade %>% 
  group_by(SEMANA_EVOLUCAO) %>%
  summarise(.groups = "drop_last",
    obito_BR = length(SEMANA_EVOLUCAO[CS_EVOLUCAO=="Óbito"]),
    total_BR = n(),
    obito_N = length(SEMANA_EVOLUCAO[CS_EVOLUCAO=="Óbito" & REGIAO=="Norte"]),
    total_N = length(SEMANA_EVOLUCAO[REGIAO=="Norte"]),
    obito_NE = length(SEMANA_EVOLUCAO[CS_EVOLUCAO=="Óbito" & REGIAO=="Nordeste"]),
    total_NE = length(SEMANA_EVOLUCAO[REGIAO=="Nordeste"]),
    obito_CO = length(SEMANA_EVOLUCAO[CS_EVOLUCAO=="Óbito" & REGIAO=="Centro-Oeste"]),
    total_CO = length(SEMANA_EVOLUCAO[REGIAO=="Centro-Oeste"]),
    obito_SE = length(SEMANA_EVOLUCAO[CS_EVOLUCAO=="Óbito" & REGIAO=="Sudeste"]),
    total_SE = length(SEMANA_EVOLUCAO[REGIAO=="Sudeste"]),
    obito_S = length(SEMANA_EVOLUCAO[CS_EVOLUCAO=="Óbito" & REGIAO=="Sul"]),
    total_S = length(SEMANA_EVOLUCAO[REGIAO=="Sul"]),
  ) %>%
arrange(SEMANA_EVOLUCAO)
```

```{r colTxLetalidade, include=FALSE}
sumariopacientesCovid = sumariopacientesCovid[sumariopacientesCovid$SEMANA_EVOLUCAO>=12,]
sumariopacientesCovid["TAXA_N"]=sumariopacientesCovid$obito_N/sumariopacientesCovid$total_N
sumariopacientesCovid["TAXA_NE"]=sumariopacientesCovid$obito_NE/sumariopacientesCovid$total_NE
sumariopacientesCovid["TAXA_CO"]=sumariopacientesCovid$obito_CO/sumariopacientesCovid$total_CO
sumariopacientesCovid["TAXA_SE"]=sumariopacientesCovid$obito_SE/sumariopacientesCovid$total_SE
sumariopacientesCovid["TAXA_S"]=sumariopacientesCovid$obito_S/sumariopacientesCovid$total_S
sumariopacientesCovid["TAXA_BR"]=sumariopacientesCovid$obito_BR/sumariopacientesCovid$total_BR
```

```{r mediaMovelTxLetalidade, include=FALSE}
mediaMovel_N <- rollmean(sumariopacientesCovid$TAXA_N, 7, align = "right")
semanaMediaMovel_N <- cbind(sumariopacientesCovid$SEMANA_EVOLUCAO, c(rep(NA, 6), mediaMovel_N))
dfMediaMovelTxLetalidade = setNames(data.frame(semanaMediaMovel_N), c("SEMANA", "TAXA_N"))
mediaMovel_NE <- rollmean(sumariopacientesCovid$TAXA_NE, 7, align = "right")
semanaMediaMovel_NE <- cbind(dfMediaMovelTxLetalidade, c(rep(NA, 6), mediaMovel_NE))
dfMediaMovelTxLetalidade = setNames(data.frame(semanaMediaMovel_NE), c("SEMANA", "TAXA_N", "TAXA_NE"))
mediaMovel_CO <- rollmean(sumariopacientesCovid$TAXA_CO, 7, align = "right")
semanaMediaMovel_CO <- cbind(dfMediaMovelTxLetalidade, c(rep(NA, 6), mediaMovel_CO))
dfMediaMovelTxLetalidade = setNames(data.frame(semanaMediaMovel_CO), c("SEMANA", "TAXA_N", "TAXA_NE", "TAXA_CO"))
mediaMovel_SE <- rollmean(sumariopacientesCovid$TAXA_SE, 7, align = "right")
semanaMediaMovel_SE <- cbind(dfMediaMovelTxLetalidade, c(rep(NA, 6), mediaMovel_SE))
dfMediaMovelTxLetalidade = setNames(data.frame(semanaMediaMovel_SE), c("SEMANA", "TAXA_N", "TAXA_NE", "TAXA_CO", "TAXA_SE"))
mediaMovel_S <- rollmean(sumariopacientesCovid$TAXA_S, 7, align = "right")
semanaMediaMovel_S <- cbind(dfMediaMovelTxLetalidade, c(rep(NA, 6), mediaMovel_S))
dfMediaMovelTxLetalidade = setNames(data.frame(semanaMediaMovel_S), c("SEMANA", "TAXA_N", "TAXA_NE", "TAXA_CO", "TAXA_SE", "TAXA_S"))

mediaMovel_BR <- rollmean(sumariopacientesCovid$TAXA_BR, 7, align = "right")
semanaMediaMovel_BR <- cbind(dfMediaMovelTxLetalidade, c(rep(NA, 6), mediaMovel_BR))
dfMediaMovelTxLetalidade = setNames(data.frame(semanaMediaMovel_BR), c("SEMANA", "TAXA_N", "TAXA_NE", "TAXA_CO", "TAXA_SE", "TAXA_S", "TAXA_BR"))
```

```{r mergeTaxaLetalidade, include=FALSE}
taxa_N= dfMediaMovelTxLetalidade[, c("SEMANA","TAXA_N")]
taxa_N["TIPO"] = "Norte" 
merge = taxa_N
colnames(merge) = c("SEMANA", "TAXA", "TIPO")
taxa_NE = dfMediaMovelTxLetalidade[, c("SEMANA","TAXA_NE")]
taxa_NE["TIPO"] = "Nordeste" 
colnames(taxa_NE) = c("SEMANA", "TAXA", "TIPO")
merge=rbind(merge, taxa_NE)
taxa_CO = dfMediaMovelTxLetalidade[, c("SEMANA","TAXA_CO")]
taxa_CO["TIPO"] = "Centro-Oeste" 
colnames(taxa_CO) = c("SEMANA", "TAXA", "TIPO")
merge=rbind(merge, taxa_CO)
taxa_SE = dfMediaMovelTxLetalidade[, c("SEMANA","TAXA_SE")]
taxa_SE["TIPO"] = "Sudeste" 
colnames(taxa_SE) = c("SEMANA", "TAXA", "TIPO")
merge=rbind(merge, taxa_SE)
taxa_S = dfMediaMovelTxLetalidade[, c("SEMANA","TAXA_S")]
taxa_S["TIPO"] = "Sul" 
colnames(taxa_S) = c("SEMANA", "TAXA", "TIPO")
merge=rbind(merge, taxa_S)
taxa_BR = dfMediaMovelTxLetalidade[, c("SEMANA","TAXA_BR")]
taxa_BR["TIPO"] = "Brasil" 
colnames(taxa_BR) = c("SEMANA", "TAXA", "TIPO")
merge=rbind(merge, taxa_BR)
```

```{r grafTaxaLetalidade, include=FALSE}
grfTxLetalidadeRegiao=ggplot(merge) +
geom_line(aes(x = SEMANA, y = TAXA, color=TIPO), na.rm = T)+
labs(x="Semana do ano", y="Taxa letalidade",
title = NULL,
subtitle = NULL, color="Regiões:") +
scale_y_continuous(labels = scales::percent)+
scale_x_continuous(labels = scales::ordinal_format(rules = ptBr))+
scale_color_manual(values = coresIntensas) +
theme_bw() +
theme(axis.text.x = element_text(size = 14), axis.title.x = element_text(size = 16),
axis.text.y = element_text(size = 14), axis.title.y = element_text(size = 16),
plot.title = element_text(size = 14, face = "bold", color = "darkgreen"))
```

```{r tabelaTxLetalidade, include=FALSE}
max(merge[merge$TIPO=="Norte" & merge$SEMANA>17,]$TAXA)
max(merge[merge$TIPO=="Nordeste" & merge$SEMANA>17,]$TAXA)
max(merge[merge$TIPO=="Centro-Oeste" & merge$SEMANA>17,]$TAXA)
max(merge[merge$TIPO=="Sudeste" & merge$SEMANA>17,]$TAXA)
max(merge[merge$TIPO=="Sul" & merge$SEMANA>17,]$TAXA)
merge[merge$TIPO=="Norte",]
merge[merge$TIPO=="Nordeste",]
```   

\qquad No que se refere as taxas de letalidade regionais o Norte e o Nordeste, apresetaram, por volta da 18ª (decima oitava) semana do ano de 2020, as taxas de letalidade mais altas do país, ambas com taxa de 50% (cinquenta por cento). Pouco tempo depois, na 20ª (vigésima) semana do ano, elas, chegam ao pior momento de 2020, momento em que a covid-19 atingiu a taxa de letalidade de 56% na região Norte e 55% na região Nordeste, essas foram as mais altas taxas de letalidades de todo país, em 2020.

\qquad Nas semanas seguintes, a região Norte, teve queda acentuada da taxa de letalidade. A Região Norte, na 22ª semana do ano, tinha a taxa de letalidade inferior a região Nordeste, esta com 54% e a região Norte, com 53%. No decorrer do ano, a taxa de letalidade da região Norte continuou a cair. Então o Nordeste passou a liderar com as mais altas taxas de letalidade por quase todo ano de 2020.

\qquad Nas últimas semanas do ano a taxa de letalidade da região Norte voltou a subir. Já nas últimas semana do ano a região Norte ultrapassou a região Nordeste.

\qquad A Região sul que havia permanecido com as menores taxas de letalidade de covid-19 do país, em 2020, em dezembro deve uma subida acentuada. O Nordeste foi a região que por mais tempo, manteve as mais altas taxas de letalidade do país, em 2020. 


```{r gridTxLetalidadeRegiao, echo=FALSE}
grid.arrange(grfTxLetalidadeRegiao, bottom="Gráfico 13: Média móvel semanal da taxa de letalidade")
```


\newpage

\section{5. Inferência Estatística}

\qquad No capítulo anterior, foi analisado os diferentes impactos da covid-19 a parti da regiões, estados e município. Neste capítulo, o foco será identificar quais as características do paciente que impactam a taxa de letalidade da covid-19, no Brasil.  

\subsection{5.1 Perfil do brasileiro com maior e menor risco de morte}

\qquad Para reduzir a variação dos valores as idades foram agrupadas em faixas. Neste momento, foram adotados os mesmos intervalos utilizados pelo \href{https://educa.ibge.gov.br/jovens/conheca-o-brasil/populacao/18318-piramide-etaria.html}{IBGE}. 

\begin{table}[htp!]
\center
\begin{tabular}{|c|c|c|c|c|} \hline
0 a 4 anos &  20 a 24 anos & 40 a 44 anos & 60 a 64 anos & 80 anos ou mais\\ \hline
5 a 9 anos &  25 a 29 anos & 45 a 49 anos & 65 a 69 anos & \\ \hline
10 a 14 anos & 30 a 34 anos & 50 a 54 anos & 70 a 74 anos & \\ \hline
15 a 19 anos & 35 a 39 anos & 55 a 59 anos & 75 a 79 anos & \\ \hline
\end{tabular}
\caption{Faixa Etária}
\label{tab:faixaEtaria}
\end{table}

```{r faixaEtaria, include=FALSE}
pacientesCovidTxLetalidade["FAIXA_ETARIA"]=NA;
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=0  & pacientesCovidTxLetalidade$NU_IDADE<5,  ]$FAIXA_ETARIA="00 a 04 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=5  & pacientesCovidTxLetalidade$NU_IDADE<10, ]$FAIXA_ETARIA="05 a 09 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=10 & pacientesCovidTxLetalidade$NU_IDADE<15, ]$FAIXA_ETARIA="10 a 14 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=15 & pacientesCovidTxLetalidade$NU_IDADE<20, ]$FAIXA_ETARIA="15 a 19 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=20 & pacientesCovidTxLetalidade$NU_IDADE<25, ]$FAIXA_ETARIA="20 a 24 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=25 & pacientesCovidTxLetalidade$NU_IDADE<30, ]$FAIXA_ETARIA="25 a 29 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=30 & pacientesCovidTxLetalidade$NU_IDADE<35, ]$FAIXA_ETARIA="30 a 34 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=35 & pacientesCovidTxLetalidade$NU_IDADE<40, ]$FAIXA_ETARIA="35 a 39 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=40 & pacientesCovidTxLetalidade$NU_IDADE<45, ]$FAIXA_ETARIA="40 a 44 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=45 & pacientesCovidTxLetalidade$NU_IDADE<50, ]$FAIXA_ETARIA="45 a 49 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=50 & pacientesCovidTxLetalidade$NU_IDADE<55, ]$FAIXA_ETARIA="50 a 54 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=55 & pacientesCovidTxLetalidade$NU_IDADE<60, ]$FAIXA_ETARIA="55 a 59 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=60 & pacientesCovidTxLetalidade$NU_IDADE<65, ]$FAIXA_ETARIA="60 a 64 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=65 & pacientesCovidTxLetalidade$NU_IDADE<70, ]$FAIXA_ETARIA="65 a 69 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=70 & pacientesCovidTxLetalidade$NU_IDADE<75, ]$FAIXA_ETARIA="70 a 74 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=75 & pacientesCovidTxLetalidade$NU_IDADE<80, ]$FAIXA_ETARIA="75 a 79 anos"
pacientesCovidTxLetalidade[pacientesCovidTxLetalidade$NU_IDADE>=80 , ]$FAIXA_ETARIA="80 anos ou mais"
pacientesCovidTxLetalidade$FAIXA_ETARIA=as.factor(pacientesCovidTxLetalidade$FAIXA_ETARIA)
```

```{r removerValoresOmissos, include=FALSE }
dadosRegressao = pacientesCovidTxLetalidade[,c("CS_SEXO", "NU_IDADE", "FAIXA_ETARIA", "CS_RACA", "IN_FATOR_RISC", "CS_EVOLUCAO", "REGIAO")]
dadosRegressao=dadosRegressao[complete.cases(dadosRegressao),]
```

```{r transDadosRegr, include=FALSE}
dadosRegressaoLogistica=dadosRegressao
dadosRegressaoLogistica$IN_FATOR_RISC=if_else(dadosRegressaoLogistica$IN_FATOR_RISC=="S", 1,0)
dadosRegressaoLogistica["IN_OBITO_COVID"]=if_else(dadosRegressaoLogistica$CS_EVOLUCAO=="Óbito", 1,0)
```

\begin{flushleft}
\large\underline{\textbf{Primeira Execução}}
\end{flushleft}

```{r modeloRegressaoLogistica1, results='hide'}
modeloRegressaoLogistica = glm(formula = IN_OBITO_COVID ~ CS_SEXO +
FAIXA_ETARIA + CS_RACA + IN_FATOR_RISC + REGIAO,
data = dadosRegressaoLogistica, family = binomial(link = "logit"))
modeloRegressaoLogistica.table <- xtable(modeloRegressaoLogistica)
print(modeloRegressaoLogistica.table, type = "LaTeX" )
```

\qquad Na primeira execução o modelo apresentou valores de baixa significância.

\qquad Para a faixa etária, nos intervalos de 5 a 9 anos e 10 a 14 anos o modelo apresentou baixa significância, o modelo, também não exibiu a faixa de 0 a 4 anos. Assim, esses intervalos foram reagrupadas em um novo intervalo de 0 a 14 anos.

\qquad No que se refere à raça do paciente, o modelo apresentou baixa significância para raça branca e não exibiu a raça amarela. Então, optou-se por agrupar as raças amarela e branca em um grupo misto. Conforme tabela \underline{\color{blue}\ref{tab:regTabLog1}} da página \underline{\color{blue}\pageref{tab:regTabLog1}}.

\newpage

\begin{table}[htp!]
\center
\begin{tabular}{|c|c|c|c|c|} \hline
   & $\beta^1$ & Std. Error & z value & Pr($>$$|$z$|$) \\ \hline
  $\beta^0$ & -3.1647 & 0.0743 & -42.61 & 0.0000 \\ \hline
  Homem & 0.2465 & 0.0075 & 32.99 & 0.0000 \\ \hline
  05 a 09 anos & -0.1450 & 0.1098 & -1.32 & 0.1865 \\ \hline
  10 a 14 anos & 0.1796 & 0.1155 & 1.56 & 0.1199 \\ \hline
  15 a 19 anos & 0.4714 & 0.0943 & 5.00 & 0.0000 \\ \hline
  20 a 24 anos & 0.4353 & 0.0809 & 5.38 & 0.0000 \\ \hline
  25 a 29 anos & 0.4097 & 0.0751 & 5.46 & 0.0000 \\ \hline
  30 a 34 anos & 0.5109 & 0.0712 & 7.18 & 0.0000 \\ \hline
  35 a 39 anos & 0.6436 & 0.0691 & 9.31 & 0.0000 \\ \hline
  40 a 44 anos & 0.8465 & 0.0683 & 12.40 & 0.0000 \\ \hline
  45 a 49 anos & 1.0456 & 0.0678 & 15.43 & 0.0000 \\ \hline
  50 a 54 anos & 1.2462 & 0.0673 & 18.51 & 0.0000 \\ \hline
  55 a 59 anos & 1.5130 & 0.0670 & 22.58 & 0.0000 \\ \hline
  60 a 64 anos & 1.8458 & 0.0668 & 27.62 & 0.0000 \\ \hline
  65 a 69 anos & 2.1292 & 0.0668 & 31.89 & 0.0000 \\ \hline
  70 a 74 anos & 2.3683 & 0.0668 & 35.45 & 0.0000 \\ \hline
  75 a 79 anos & 2.5917 & 0.0670 & 38.71 & 0.0000 \\ \hline
  80 anos ou mais & 2.9861 & 0.0666 & 44.85 & 0.0000 \\ \hline
  Branca & 0.0225 & 0.0316 & 0.71 & 0.4764 \\ \hline
  Indígina & 0.3425 & 0.0667 & 5.13 & 0.0000 \\ \hline
  Parda & 0.1790 & 0.0316 & 5.66 & 0.0000 \\ \hline
  Preta & 0.3760 & 0.0343 & 10.95 & 0.0000 \\ \hline
  Tem comorbidades & 0.5298 & 0.0085 & 62.17 & 0.0000 \\ \hline
  Nordeste & 0.4173 & 0.0158 & 26.37 & 0.0000 \\ \hline
  Norte & 0.3576 & 0.0181 & 19.79 & 0.0000 \\ \hline
  Sudeste & 0.0532 & 0.0144 & 3.70 & 0.0002 \\ \hline
  Sul & -0.1697 & 0.0169 & -10.04 & 0.0000 \\ \hline
\end{tabular}
\caption{Modelo com valores de baixa significância presentes}
\label{tab:regTabLog1}
\end{table}

\newpage

```{r ajusteModelo, include=FALSE}
dadosRegressaoLogistica$FAIXA_ETARIA=as.character(dadosRegressaoLogistica$FAIXA_ETARIA)
dadosRegressaoLogistica[dadosRegressaoLogistica$NU_IDADE<15, ]$FAIXA_ETARIA="0 a 14 anos"
dadosRegressaoLogistica$FAIXA_ETARIA=as.factor(dadosRegressaoLogistica$FAIXA_ETARIA)
dadosRegressaoLogistica[dadosRegressaoLogistica$CS_RACA=="Amarela", ]$CS_RACA
dadosRegressaoLogistica[dadosRegressaoLogistica$CS_RACA=="Amarela", ]$CS_RACA = "Branca"
dadosRegressaoLogistica$CS_RACA=as.factor(dadosRegressaoLogistica$CS_RACA)
```

\begin{flushleft}
\large\underline{\textbf{Segunda Execução}}
\end{flushleft}

```{r modeloRegressaoLogistica2, results='hide'}
modeloRegressaoLogistica = glm(formula = IN_OBITO_COVID ~ CS_SEXO +
FAIXA_ETARIA + CS_RACA + IN_FATOR_RISC + REGIAO,
data = dadosRegressaoLogistica, family = binomial(link = "logit"))
modeloRegressaoLogistica.table <- xtable(modeloRegressaoLogistica)
print(modeloRegressaoLogistica.table, type = "LaTeX" )
```

```{r logitRiscoDeVida, include=FALSE}
#Maior risco de vida
 maiorRisco = -3.1459 + 2.9888 + 0.5299 + 0.4171 + 0.3543 + 0.2465
 maiorRisco =  (exp(maiorRisco) / (1+exp(maiorRisco)))
 maiorRisco
 #Maior risco de vida
 menorRisco = -3.1459 - 0.1689
 menorRisco =  (exp(menorRisco) / (1+exp(menorRisco)))
 menorRisco
```

\qquad Após o ajuste do modelo e a reexecução em uma amostra com 383.266 (trezentos e oitenta e três mil e duzentos e sessenta e seis) pacientes. Conclui-se que o perfil com maior risco de morte tem: idade de 80 (oitenta) anos ou mais ($\beta^1$ : 2.9888), já apresenta doenças preexistentes ($\beta^1$ : 0.5299), reside na região nordeste ($\beta^1$ : 0.4171), é de cor preta 
($\beta^1$ : 0.3543) e homem ($\beta^1$ : 0.2465), com probabilidade de óbito de 80%.

\qquad Já o perfil com menor risco de morte no Brasil: reside na região sul ($\beta^1$ : -0.1689), tem idade de 0 (zero) a 14 (quatorze) anos, não tem doenças preexistentes, é de cor branca ou amarela e do sexo feminino, com probabilidade de óbito por covid-19 de 3,5%.

\qquad Os valores de $\beta^0$ e $\beta^1$ do modelo otimizado podem ser verificados na tabela: \underline{\color{blue}\ref{tab:regTabLog2}} da página \underline{\color{blue}\pageref{tab:regTabLog2}}.

\newpage

\begin{table}[htp!]
\center
\begin{tabular}{|c|c|c|c|c|} \hline
   & $\beta^1$ & Std. Error & z value & Pr($>$$|$z$|$) \\ \hline
  $\beta^0$ & -3.1459 & 0.0488 & -64.53 & 0.0000 \\ \hline
  Homem & 0.2465 & 0.0075 & 32.98 & 0.0000 \\ \hline
  15 a 19 anos & 0.4742 & 0.0817 & 5.80 & 0.0000 \\ \hline
  20 a 24 anos & 0.4380 & 0.0659 & 6.65 & 0.0000 \\ \hline
  25 a 29 anos & 0.4124 & 0.0585 & 7.05 & 0.0000 \\ \hline
  30 a 34 anos & 0.5136 & 0.0534 & 9.62 & 0.0000 \\ \hline
  35 a 39 anos & 0.6463 & 0.0507 & 12.76 & 0.0000 \\ \hline
  40 a 44 anos & 0.8491 & 0.0494 & 17.17 & 0.0000 \\ \hline
  45 a 49 anos & 1.0483 & 0.0487 & 21.51 & 0.0000 \\ \hline
  50 a 54 anos & 1.2489 & 0.0481 & 25.95 & 0.0000 \\ \hline
  55 a 59 anos & 1.5157 & 0.0477 & 31.79 & 0.0000 \\ \hline
  60 a 64 anos & 1.8485 & 0.0474 & 38.96 & 0.0000 \\ \hline
  65 a 69 anos & 2.1319 & 0.0473 & 45.03 & 0.0000 \\ \hline
  70 a 74 anos & 2.3709 & 0.0474 & 50.03 & 0.0000 \\ \hline
  75 a 79 anos & 2.5944 & 0.0476 & 54.48 & 0.0000 \\ \hline
  80 anos ou mais & 2.9888 & 0.0471 & 63.48 & 0.0000 \\ \hline
  Indígina & 0.3206 & 0.0595 & 5.39 & 0.0000 \\ \hline
  Parda & 0.1574 & 0.0090 & 17.55 & 0.0000 \\ \hline
  Preta & 0.3543 & 0.0156 & 22.64 & 0.0000 \\ \hline
  Tem comorbidade & 0.5299 & 0.0085 & 62.18 & 0.0000 \\ \hline
  Nordeste & 0.4171 & 0.0158 & 26.36 & 0.0000 \\ \hline
  Norte & 0.3576 & 0.0181 & 19.79 & 0.0000 \\ \hline
  Sudeste & 0.0535 & 0.0144 & 3.72 & 0.0002 \\ \hline
  Sul & -0.1689 & 0.0169 & -10.01 & 0.0000 \\ \hline
\end{tabular}
\caption{Modelo de regressão logística otimizado}
\label{tab:regTabLog2}
\end{table}

\newpage

\section{6. Machine learning}

\qquad Neste capítulo, utiliza-se técnicas de machine learning para identificar outros atributos com impacto no risco de óbito dos pacientes, além dos atributos já descritos nas seções anteriores novos atributos serão incorporados aos modelos. Os algorítimos, também serão diversificados. 

\qquad A eficiência dos atributos selecionados, bem como o algorítimo utilizado, será mensurada a partir da taxa de acerto do algorítimo.

```{r dataFrameDadosMachineLearning, include=FALSE}
#Preparando o datafreme a ser testado.
dadosMachineLearningObito = pacientesCovidTxLetalidade[,c("CS_SEXO", "NU_IDADE", 
"FAIXA_ETARIA", "CS_RACA", "IN_FATOR_RISC", "CS_EVOLUCAO", "MUNICIPIO",
"COD_MUNICIPIO", "SG_UF", "IN_PUERPERA", "IN_CARDIOPATI", "IN_HEMATOLOGI",
"IN_SINDROME_DOWN", "IN_DOENCA_HEPATICA", "IN_ASMA", "IN_DIABETES",
"IN_DOENCA_NEUROLOGICA","IN_PNEUMOPATIA_CRONICA", "IN_IMUNODEPRESSAO",
"IN_DOENCA_RENAL", "IN_OBESIDADE", "IN_NOSOCOMIAL", "HOSPITAL", "IN_RECEBEU_VACINA_GRIPE", "REGIAO")]
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_PUERPERA),]$IN_PUERPERA='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_CARDIOPATI),]$IN_CARDIOPATI='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_HEMATOLOGI),]$IN_HEMATOLOGI='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_SINDROME_DOWN),]$IN_SINDROME_DOWN='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_DOENCA_HEPATICA),]$IN_DOENCA_HEPATICA='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_ASMA),]$IN_ASMA='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_DIABETES),]$IN_DIABETES='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_DOENCA_NEUROLOGICA),]$IN_DOENCA_NEUROLOGICA='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_PNEUMOPATIA_CRONICA),]$IN_PNEUMOPATIA_CRONICA='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_IMUNODEPRESSAO),]$IN_IMUNODEPRESSAO='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_DOENCA_RENAL),]$IN_DOENCA_RENAL='Não'
dadosMachineLearningObito[is.na(dadosMachineLearningObito$IN_OBESIDADE),]$IN_OBESIDADE='Não'
dadosMachineLearningObito$CS_EVOLUCAO=if_else(dadosMachineLearningObito$CS_EVOLUCAO!="Cura", "OBITO","CURA")
dadosMachineLearningObito$CS_EVOLUCAO=as.factor(dadosMachineLearningObito$CS_EVOLUCAO);
dadosMachineLearningObito$CS_SEXO=as.factor(dadosMachineLearningObito$CS_SEXO)
dadosMachineLearningObito$IN_FATOR_RISC=as.character(dadosMachineLearningObito$IN_FATOR_RISC);
dadosMachineLearningObito$IN_FATOR_RISC=if_else(dadosMachineLearningObito$IN_FATOR_RISC==1, "S","N")
dadosMachineLearningObito$IN_FATOR_RISC=as.factor(dadosMachineLearningObito$IN_FATOR_RISC);
dadosMachineLearningObito$IN_NOSOCOMIAL=if_else(dadosMachineLearningObito$IN_NOSOCOMIAL==1, "Sim","Não")
dadosMachineLearningObito$IN_NOSOCOMIAL=as.factor(dadosMachineLearningObito$IN_NOSOCOMIAL);
dadosMachineLearningObito$IN_RECEBEU_VACINA_GRIPE=if_else(dadosMachineLearningObito$IN_RECEBEU_VACINA_GRIPE==1, "Sim","Não")
dadosMachineLearningObito$IN_RECEBEU_VACINA_GRIPE=as.factor(dadosMachineLearningObito$IN_RECEBEU_VACINA_GRIPE);
dadosMachineLearningObito=dadosMachineLearningObito[complete.cases(dadosMachineLearningObito),];
```

\qquad Os dados utilizados nos treinamentos dos modelos, bem como os dados utilizados nos testes, serão extraídos a partir de uma amostra aleatória com 1000 (um mil) registros. Sendo 70% (setenta por cento) da amostra destinada para o treinamento e 30%(trinta por cento) destinada para os testes.

```{r amostraMachine, echo=FALSE}
amostra = sample(2,1000, replace = T, prob=c(0.7,0.3))
dadosTreino=dadosMachineLearningObito[amostra==1,]
dadosTeste=dadosMachineLearningObito[amostra==2,]
```

\subsection{6.1 Árvore de Decisão de Classificação}

\qquad Na primeira execução, o algorítimo utilizado será o rpart e os atributos serão os mesmos utilizados nas seção de inferência estatística. Com essa configuração a taxa de acerto do modelo foi 69% (sessenta e nove por cento).

```{r arvore1}
arvoreClassificacao = rpart(formula =  CS_EVOLUCAO ~ CS_SEXO +
FAIXA_ETARIA + CS_RACA + IN_FATOR_RISC + REGIAO,
data = dadosMachineLearningObito, method = "class")
```

```{r arvorePredict1}
teste = predict(arvoreClassificacao, newdata = dadosTeste)
previsao=cbind(teste, dadosTeste)
previsao["PREVISAO"]=ifelse(previsao$CURA>.5,"CURA", "OBITO")
```

```{r arvoreTaxa}
confusao=table(previsao$CS_EVOLUCAO, previsao$PREVISAO)
taxaAcerto = (confusao[1]+confusao[4])/sum(confusao)
taxaAcerto
```

\subsection{6.2 Arvore de Decição e Seleção de Atributos}

\qquad Com método randomForest e mantendo praticamente os mesmo atributos da execução anterior, com exceção do atributo REGIAO, substituído pelo atributo SG_UF a taxa de acerto referente ao risco de morte do paciente, apresenta uma pequena melhora. A após a mudança, a taxa de acertou passou para 70% (setenta por cento).

```{r randomForest}
selecaoAtributos = randomForest(CS_EVOLUCAO ~ CS_SEXO +
FAIXA_ETARIA + CS_RACA + IN_FATOR_RISC + SG_UF, data = dadosTreino)
```

```{r randomForestPrevisao}
teste = predict(selecaoAtributos, dadosTeste)
previsao=cbind(teste , dadosTeste)
previsao["PREVISAO"]=previsao$teste
```

```{r randomForestTx}
confusao=table(previsao$CS_EVOLUCAO, previsao$PREVISAO)
taxaAcerto = (confusao[1]+confusao[4])/sum(confusao)
taxaAcerto
```

\qquad O gráfico abaixo apresenta os atributos mais significativos na classificação de risco de morte do paciente. A FAIXA_ETARIA do paciente é o atributo com maior peso na classificação do registro em relação ao risco de morte. Nas próximas execuções detalharemos mais os atributos FAIXA_ETARIA e SG_UF.

```{r varImpPlot}
varImpPlot(selecaoAtributos, main="Atributos mais significativos")
```

\subsection{6.3 Árvore de Decisão de Classificação otimizado}

\qquad Utilizando novamente a função rpart agora com atributo NU_IDADE e MUNICIPIO, a taxa de acerto passou a ser de 71% (setenta e um por cento)

```{r arvore2}
arvoreClassificacao = rpart(formula =  CS_EVOLUCAO ~  NU_IDADE + MUNICIPIO,
                            data = dadosMachineLearningObito, method = "class")
```

```{r arvor2Predict}
teste = predict(arvoreClassificacao, newdata = dadosTeste)
previsao=cbind(teste, dadosTeste)
previsao["PREVISAO"]=ifelse(previsao$CURA>.5,"CURA", "OBITO")
```

```{r arvore2Taxa}
confusao=table(previsao$CS_EVOLUCAO, previsao$PREVISAO)
taxaAcerto = (confusao[1]+confusao[4])/sum(confusao)
taxaAcerto
```
\qquad Quando adicionado o hospital de atendimento do paciente como atributo do modelo, a taxa de acerto passa a ser de 74% (setenta e quatro por cento).

```{r arvore3}
arvoreClassificacao = rpart(formula =  CS_EVOLUCAO ~  NU_IDADE + MUNICIPIO + HOSPITAL,
                            data = dadosMachineLearningObito, method = "class")
```

```{r arvor3Predict}
teste = predict(arvoreClassificacao, newdata = dadosTeste)
previsao=cbind(teste, dadosTeste)
previsao["PREVISAO"]=ifelse(previsao$CURA>.5,"CURA", "OBITO")
```

```{r arvore3Taxa}
confusao=table(previsao$CS_EVOLUCAO, previsao$PREVISAO)
taxaAcerto = (confusao[1]+confusao[4])/sum(confusao)
taxaAcerto
```

\subsection{6.4 Naive Bayse}

\qquad Com os mesmo atributos da seção anterior e o método naiveBayes do pacote e1071 a taxa de acerto foi menor, 71% (setenta e um por cento)

```{r modeloNaiveBayes, results='hide'}
modeloNaiveBayes = naiveBayes(formula =  CS_EVOLUCAO ~  NU_IDADE + MUNICIPIO + HOSPITAL,
data = dadosTreino)
```

```{r modeloNaiveBayesPredic}
teste = predict(modeloNaiveBayes, dadosTeste)
previsao=cbind(teste , dadosTeste)
previsao["PREVISAO"]=previsao$teste
```

```{r modeloNaiveBayesTaxa}
confusao=table(previsao$CS_EVOLUCAO, previsao$PREVISAO)
taxaAcerto = (confusao[1]+confusao[4])/sum(confusao)
taxaAcerto
```

\newpage


\section\begin{thebibliography}{OPHS15}
\bibitem[1]{Gallagher:2020}
Gallagher, James. \emph{Coronavírus é 'tão mortal quanto ebola' em casos de internação, diz estudo britânico.\emph{DATA GEEKS, 29 abr. 2020.}}
Disponível em: \url{https://www.bbc.com/portuguese/geral-52481818}
- ( Acessado em: 14 jan. 2021 )
\bibitem[2]{GOMES:2019}
GOMES, Pedro César Tebaldi.
\emph{Classificação com Naive Bayes. \emph{DATA GEEKS, 22 fev. 2019.}}
Disponível em: \url{https://www.datageeks.com.br/naive-bayes/}
- ( Acessado em: 14 jan. 2021 )
\bibitem[3]{Hosokawa:2011}
Hosokawa, Eric Ossamu. \emph{Técnica de Árvore de Decisão em Mineração de Dados. 2011. Trabalho de Conclusão de Curso (Tecnólogo em Processamento de Dados) - \emph{Faculdade de Tecnologia de São Paulo, São Paulo, 2011.}}
\bibitem[4]{JUNIOR:2010}
JUNIOR, Gilson Medeiros de Oliveira. \emph{Máquina de Vetores Suporte: estudo e análise de parâmetros para otimização de resultado. 2010. Trabalho de Conclusão de Curso (Bacharelado em Ciência da Computação) - \emph{Universidade Federal de Pernambuco, Recife, 2010.}}
\bibitem[5]{MEHTA:2017}
MEHTA, \emph{R. Big Data Analytics with Java. \emph{Birmingham: Packt Publishing Ltd, 2017.}}
\bibitem[6]{OPENDATASUS:2021}
Portal OpenDataSUS,  \emph{SRAG 2021 - Banco de Dados de Síndrome Respiratória.\emph{OpenDataSUS, 10 jan. 2021.}}
Disponível em: \url{https://opendatasus.saude.gov.br/dataset/bd-srag-2021}
\bibitem[7]{SANTOS:2017}
SANTOS, Roberto Moreira. \emph{A importância do uso de ferramentas de analítica preditiva gratuitas para as empresas. 2017. Trabalho de Conclusão de Curso (Bacharelado em Sistemas de Informação) - \emph{Universidade Federal de Pernambuco, Recife, 2017.}}
\end{thebibliography}

\newpage

\section{Apêndice A - Taxa de Mortalidade Estados e Capitais}

```{r apendice1, echo=FALSE, results='hide'}

txEstados = taxaDeMortalidadePorRegiao[,c("SG_UF", "QTD_MUNICIPIO", "NU_POPULACAO", "TX_MORTALIDADE")]
txCapitais = taxaDeMortalidadePorCapitais[,c("SG_UF", "COD_MUNICIPIO.y", "MUNICIPIO", "NU_POPULACAO", "TX_MORTALIDADE")]
colnames(txCapitais) = c("SG_UF", "COD_MUNICIPIO", "MUNICIPIO", "NU_POPULACAO_CAPITAL", "TX_MORTALIDADE_CAPITAL")
estadosECapitais = txEstados %>% inner_join(txCapitais, c("SG_UF" = "SG_UF")) %>%
arrange(desc(TX_MORTALIDADE))
estadosECapitais = estadosECapitais[, c("SG_UF", "NU_POPULACAO", "TX_MORTALIDADE", "MUNICIPIO", "NU_POPULACAO_CAPITAL", "TX_MORTALIDADE_CAPITAL")]
estadosECapitais.table <- xtable(estadosECapitais)
print(estadosECapitais.table, type = "LaTeX" )
```

\begin{table}[htp!]
\center
\begin{tabular}{|c|c|r|r|c|r|r|} \hline
   & UF & População & Mortalidade & Capital & População & Mortalidade \\ \hline
  1 & RJ & 17.366.189 & 1.470 & Rio de Janeiro & 6.747.815 & 2.556 \\ \hline
  2 & DF & 3.055.149 & 1.439 & Brasília & 3.055.149 & 1.439 \\ \hline
  3 & AM & 4.2077.14 & 1.254 & Manaus & 2.219.580 & 1.774 \\ \hline
  4 & CE & 9.187.103 & 1.119 & Fortaleza & 2.686.612 & 2.126 \\ \hline
  5 & SE & 2.318.822 & 1.110 & Aracaju & 664.908 & 2.472 \\ \hline
  6 & SP & 46.289.333 & 1.020 & São Paulo & 12.325.232 & 1.436 \\ \hline
  7 & PE & 9.616.621 & 997 & Recife & 1.653.461 & 3.313 \\ \hline
  8 & RR & 631.181 & 969 & Boa Vista & 419.652 & 1.458 \\ \hline
  9 & RO & 1.796.460 & 927 & Porto Velho & 539.354 & 1.902 \\ \hline
  10 & GO & 7.113.540 & 924 & Goiânia & 1.536.097 & 1.764 \\ \hline
  11 & PB & 4.039.277 & 906 & João Pessoa & 817.511 & 1.913 \\ \hline
  12 & ES & 4.064.052 & 879 & Vitória & 365.855 & 1.697 \\ \hline
  13 & MS & 2.809.394 & 849 & Campo Grande & 906.092 & 1.498 \\ \hline
  14 & PA & 8.690.745 & 839 & Belém & 1.499.641 & 2175 \\ \hline
  15 & RS & 11.422.973 & 788 & Porto Alegre & 1.488.252 & 1.820 \\ \hline
  16 & AP & 861.773 & 770 & Macapá & 512.902 & 1.015 \\ \hline 
  17 & AL & 3.351.543 & 751 & Maceió & 1.025.360 & 1.566 \\ \hline
  18 & TO & 1.590.248 & 728 & Palmas & 306.296 & 1.227 \\ \hline
  19 & PI & 3.281.480 & 723 & Teresina & 868.075 & 1.999 \\ \hline
  20 & SC & 7.252.502 & 706 & Florianópolis & 508.826 & 972 \\ \hline
  21 & PR & 11.516.840 & 666 & Curitiba & 1.948.626 & 1.508 \\ \hline
  22 & RN & 3.534.165 & 655 & Natal & 890.480 & 1.593 \\ \hline
  23 & AC & 894.470 & 655 & Rio Branco & 413.418 & 1.306 \\ \hline
  24 & MG & 21.292.666 & 565 & Belo Horizonte & 2.521.564 & 1.009 \\ \hline
  25 & MT & 3.526.220 & 560 & Cuiabá & 618.124 & 1.389 \\ \hline
  26 & BA & 14.930.634 & 557 & Salvador & 2.886.698 & 1.426 \\ \hline
  27 & MA & 7.s114.598 & 467 & São Luís & 1.108.975 & 1.264 \\ \hline
\end{tabular}
\caption{Taxa Mortalidade Estados e Capitais}
\label{tab:taxaEstadosECapitais}
\end{table}

\newpage

\includepdf[scale=0.8, pages={1}, pagecommand={\section{Anexo A - Ficha de Notificação}}]{anexos/ficha-srag-final-27.07.2020_final.pdf} 
\includepdf[scale=0.8, pages={2}]{anexos/ficha-srag-final-27.07.2020_final.pdf} 

\includepdf[scale=0.8, angle=90, pages={1}, pagecommand={\section{Anexo B - Dicionário de dados}}]{anexos/dicionario-de-dados-srag-hospitalizado-27.07.2020-final.pdf} 
\includepdf[scale=0.8, angle=90, pages={2-}]{anexos/dicionario-de-dados-srag-hospitalizado-27.07.2020-final.pdf} 
